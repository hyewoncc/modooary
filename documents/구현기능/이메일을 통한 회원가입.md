
## ì´ë©”ì¼ì„ í†µí•œ íšŒì›ê°€ì…  

ëª¨ë‘ì–´ë¦¬ëŠ” ì´ë©”ì¼ ê³„ì •ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ê°€ì…í•  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤  
ë‹‰ë„¤ì„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ì´ë©”ì¼ì„ í†µí•´ ê°€ì… í™•ì¸ ë©”ì¼ì´ ì „ì†¡ë˜ê³ ,  
ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ë°”ë¡œ ëª¨ë‘ì–´ë¦¬ íšŒì›ì´ ë©ë‹ˆë‹¤  
<br/>
ëª©ì°¨
- [âœï¸íšŒì›ê°€ì… ì‹œ javascriptë¥¼ ì´ìš©í•œ ì…ë ¥ ìœ íš¨ì„± ê²€ì¦](#%EF%B8%8FíšŒì›ê°€ì…-ì‹œ-javascriptë¥¼-ì´ìš©í•œ-ì…ë ¥-ìœ íš¨ì„±-ê²€ì¦)  
- [ğŸ§ªajax í†µì‹ ì„ í†µí•œ ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬](#ajax-í†µì‹ ì„-í†µí•œ-ì´ë©”ì¼-ì¤‘ë³µ-ê²€ì‚¬)  
- [âœ‰ï¸ìë°” ë©”ì¼ë¡œ íšŒì›ê°€ì… ë©”ì¼ ë°œì†¡](#%EF%B8%8Fìë°”-ë©”ì¼ë¡œ-íšŒì›ê°€ì…-ë©”ì¼-ë°œì†¡)  
- [âœ…url íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•œ ì •íšŒì› ì „í™˜](#url-íŒŒë¼ë¯¸í„°ë¥¼-ì´ìš©í•œ-ì •íšŒì›-ì „í™˜)  
- [ğŸ™†ì •íšŒì› ë“±ë¡ ì™„ë£Œì™€ ë¡œê·¸ì¸](#ì •íšŒì›-ë“±ë¡-ì™„ë£Œì™€-ë¡œê·¸ì¸)  

<br/>

### âœï¸íšŒì›ê°€ì… ì‹œ javascriptë¥¼ ì´ìš©í•œ ì…ë ¥ ìœ íš¨ì„± ê²€ì¦  
![2021-06-30 18 57 43](https://user-images.githubusercontent.com/80666066/123943044-b2261100-d9d6-11eb-8a64-df3d49fdc316.gif)
íšŒì›ê°€ì… ì‹œ ì´ìš©ìê°€ ì…ë ¥í•œ ì •ë³´ì˜ ìœ í˜•ì— ë”°ë¼ ìœ íš¨ì„±ì„ ê²€ì¦í•˜ê³ ,  
ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì–‘ì‹ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆì„ ì‹œ ìš°ì¸¡ ìƒë‹¨ ì•Œë¦¼ê³¼ í•¨ê»˜ ì…ë ¥ í•­ëª©ë§ˆë‹¤ ì•ˆë‚´ë¥¼ ë‹¬ì•„ì¤ë‹ˆë‹¤  
<br/>

```javascript
//íšŒì›ê°€ì… í¼ì˜ ìœ íš¨ì„± ê²€ì¦
function checkJoinForm() {

    //ì´ì „ ê²€ì¦ í›„ í‘œì‹œëœ ì—ëŸ¬ ë¬¸êµ¬ë¥¼ ì¼ê´„ ì‚­ì œ
    eraseErrors();
    let result = true;

    //ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì¼ì¸ì§€ ê²€ì¦
    if(!checkEmailUsable(document.getElementById('email').value)){
        result = false;
    }

    //ì…ë ¥ê°’ë“¤ì˜ ìœ íš¨ì„± ê²€ì¦
    if(!checkName(document.getElementById('name').value)){
        result = false;
    }

    if(!checkPassword(document.getElementById('password').value)) {
        result = false;
    }

    if(!checkPasswordCheck(document.getElementById('password').value,
        document.getElementById('password-check').value)) {
        result = false;
    }

    if(!checkEmail('email-error',document.getElementById('email').value)){
        result = false;
    }

    //ì…ë ¥ ê³µë€ì´ ìˆëŠ”ì§€ ê²€ì¦
    if(!checkBlank('name', 'ë‹‰ë„¤ì„ì„')){
        result = false;
    }

    if(!checkBlank('email', 'ì´ë©”ì¼ì„')){
        result = false;
    }

    if(!checkBlank('password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼')) {
        result = false;
    }

    if(!checkBlank('password-check', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ')){
        result = false;
    }

    if(result){
        if(submitCheck){
            toastr.info('ê°€ì… ë©”ì¼ì„ ì „ì†¡í•˜ê³  ìˆì–´ìš”');
            submitCheck = false;
        }else{
            toastr.info('ë©”ì¼ì„ ì „ì†¡ì¤‘ì´ì—ìš”<br/>ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”');
            result = false;
        }
    }else{
        toastr.warning('ì…ë ¥ ì–‘ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”');
    }

    return result;
}
```
<br/>  
joinJs.js íŒŒì¼ì—ì„œ ê° ê²€ì‚¬ í•¨ìˆ˜ë“¤ì„ ìƒì„¸íˆ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤<br/>
https://github.com/hyewoncc/modooary/blob/main/src/main/resources/static/js/diaryJs.js  
<br/>
<hr><br/>

### ğŸ§ªajax í†µì‹ ì„ í†µí•œ ì´ë©”ì¼ ì¤‘ë³µ ê²€ì‚¬  
![2021-06-30 20 45 49](https://user-images.githubusercontent.com/80666066/123955465-9c1f4d00-d9e4-11eb-885e-1f79f0ff21db.gif)

íŠ¹íˆ ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬ì˜ ê²½ìš°, ajax í†µì‹ ì„ í†µí•´ ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì¸ì§€ dbë¥¼ ì¡°íšŒí•´ í™•ì¸í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤  
ì˜ˆì œë¥¼ ìœ„í•´ dbì— cat@gmail.com ë©”ì¼ì„ ê°–ëŠ” ê³„ì •ì„ ë“±ë¡í•˜ê³  ì§„í–‰í–ˆìŠµë‹ˆë‹¤<br/>. 

```javascript
//ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì¼ì¸ì§€ í™•ì¸
//ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì¼ì´ë©´ true, ì•„ë‹ˆë©´ false ë°˜í™˜
function checkEmailUsable(email) {
    let data = {'email' : email};
    let checkResult = false;

    $.ajax({
        url: '/sign-in/check-email',
        data: data,
        type: 'post',
        async: false,
        success: function (result){
            if(result){
                checkResult = true;
            }else{
                document.getElementById('email-error').innerHTML = 'ì´ë¯¸ ê°€ì…ëœ ë©”ì¼ì…ë‹ˆë‹¤';
                document.getElementById('email-error').style.display = 'inline';
            }
        }
    })
    return checkResult;
}
```
<br/>
ajax í†µì‹ ì„ í†µí•´ post í˜•ì‹ìœ¼ë¡œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë³´ë‚´ë©´,  
ì„œë²„ë‹¨ì—ì„œ db ì¡°íšŒ í›„ true/falseë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ë°˜í™˜í•´ì¤ë‹ˆë‹¤<br/>. 

```java
public class MemberService {
    @PostMapping("/sign-in/check-email")
    @ResponseBody
    public boolean checkEmail(HttpServletRequest request) {
        //ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì¸ì§€ í™•ì¸í•˜ê³  ì‚¬ìš© ê°€ëŠ¥í•  ì‹œ true, ë¶ˆê°€ì¼ ì‹œ false ë°˜í™˜
        String email = request.getParameter("email");
        return memberService.checkEmailUsable(email);
    }
}
```  
<br/>
í•´ë‹¹ ì´ë©”ì¼ì„ dbì—ì„œ ì¡°íšŒí•˜ê¸°ìœ„í•´ ì‘ì„±í•œ ì¿¼ë¦¬ë¬¸ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤<br/>  

```java
@Repository
public class MemberRepository {

    //ì¤‘ë³µë˜ëŠ” ì´ë©”ì¼ì´ ìˆëŠ”ì§€ ê²€ì‚¬
    public boolean checkEmail(String email) {
        try{
            Member member = em.createQuery("select m from Member m" + "" +
                    " where m.email = :email", Member.class)
                    .setParameter("email", email)
                    .getSingleResult();
        }catch (NoResultException e) {
            return true;
        }
        return false;
    }
}
```

<br/>
ì´ë¯¸ ìˆëŠ” ì´ë©”ì¼ë¡œ ê°€ì…ì„ ì‹œë„í–ˆì„ ê²½ìš°, ì´ë¯¸ì§€ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì•ˆë‚´ì™€ í•¨ê»˜ ì•Œë ¤ì¤ë‹ˆë‹¤  
<br/>
<hr><br/>


### âœ‰ï¸ìë°” ë©”ì¼ë¡œ íšŒì›ê°€ì… ë©”ì¼ ë°œì†¡  

![2021-06-30 19 02 01](https://user-images.githubusercontent.com/80666066/123950630-dab20900-d9de-11eb-8f8d-8f4824d5d0a2.gif)
<br/>
ëª¨ë“  ì •ë³´ê°€ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥ë˜ì—ˆë‹¤ë©´ ì…ë ¥ëœ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë©”ì¼ì„ ì „ì†¡í•©ë‹ˆë‹¤  
ì´ ë•Œ, í¼ì—ì„œ ì—”í„° ì—°íƒ€ë‚˜ ë²„íŠ¼ ë‹¤íšŒ í´ë¦­ìœ¼ë¡œ ì¸í•œ ë‹¤ì¤‘ ì œì¶œì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ë§‰ì•„ì¤¬ìŠµë‹ˆë‹¤  
ê·¸ë¦¬ê³  ì§„í–‰ ìƒí™©ì„ ìš°ì¸¡ ìƒë‹¨ì˜ ì•Œë¦¼ìœ¼ë¡œ ê³„ì† ì•Œë ¤ì¤ë‹ˆë‹¤  
<br/>
ì…ë ¥ ì •ë³´ë¥¼ í†µí•´ ë©”ì¼ì´ ë°œì†¡ë˜ëŠ” ì„œë²„ë‹¨ì˜ ì½”ë“œëŠ” ê³¼ì •ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤  

1. ì»¨íŠ¸ë¡¤ëŸ¬ì— ì „ë‹¬ëœ ì…ë ¥ ê°’ìœ¼ë¡œ ì„ì‹œ íšŒì›ì„ dbì— ì €ì¥  
2. ì„ì‹œ íšŒì›ì˜ ì´ë©”ì¼ë¡œ ë©”ì¼ ë°œì†¡
3. ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ì„¸ì…˜ì— ì €ì¥
4. ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™ ë° ì„¸ì…˜ ê°’ìœ¼ë¡œ ì•ŒëŒ ë„ìš°ê¸°  

ë¨¼ì € ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì´ë©”ì¼ ì „ì†¡ ê°ì²´(emailUtil)ì˜ ì½”ë“œì…ë‹ˆë‹¤<br/>  

```java
@Controller
@RequiredArgsConstructor
public class MemberController {

    @PostMapping("/sign-in")
    public String sendSignInMail(@Valid MemberForm memberForm, BindingResult result, HttpSession session) {

        //ì…ë ¥ ì •ë³´ë¥¼ ë°›ì•„ ì„ì‹œ íšŒì›ìœ¼ë¡œ ì €ì¥
        PreMember preMember = PreMember.createPreMember(
                memberForm.getEmail(), memberForm.getPassword(), memberForm.getName());
        memberService.joinPreMember(preMember);

        //ì„ì‹œ íšŒì› ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ í™•ì¸ ì´ë©”ì¼ ë°œì†¡ í›„ ë©”ì¸ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        try {
            emailUtil.sendJoinMail(
                    preMember.getName(), preMember.getEmail(), preMember.getId(), preMember.getKey());
            session.setAttribute("emailAlert", 1);
        } catch (MessagingException | UnsupportedEncodingException e) {
            session.setAttribute("emailAlert", -1);
            e.printStackTrace();
        }

        return "redirect:/";
    }
}
```
ì—¬ê¸°ì„œ ì„ì‹œ íšŒì›ì¸ PreMember ê°ì²´ê°€ createPreMember ë©”ì†Œë“œë¡œ ë§Œë“¤ì–´ ì§ˆ ë•Œ,  
ìë™ìœ¼ë¡œ 6ìë¦¬ ë‚œìˆ˜ì˜ í‚¤ê°’ì„ ê°–ë„ë¡ í–ˆìŠµë‹ˆë‹¤  
ì´ í‚¤ê°’ê³¼ PreMember ì—”í‹°í‹°ì˜ idê°’ì„ ì´ë©”ì¼ë¡œ ì „ì†¡í•´ ì¸ì¦í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤  
<br/>

```java
@Component
@RequiredArgsConstructor
public class EmailUtil {

    private final JavaMailSender javaMailSender;
    String address = "localhost:8080";

    //ê°€ì… ë©”ì¼ ì „ì†¡
    public void sendJoinMail(
            String name, String email, Long prememberId, String key) throws MessagingException, UnsupportedEncodingException {
        MimeMessage message = javaMailSender.createMimeMessage();
        InternetAddress admin = new InternetAddress("noreply@modooary.com");
        admin.setPersonal("modooary");
        message.setFrom(admin);
        message.setRecipients(Message.RecipientType.TO, email);
        message.setSubject(name + "ë‹˜ì˜ ëª¨ë‘ì–´ë¦¬ ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤");

        String content = new StringBuffer().append("<h2>ëª¨ë‘ì–´ë¦¬</h2>")
                .append("ë§í¬ë¥¼ ëˆŒëŸ¬ ê°€ì…ì„ ì™„ë£Œí•˜ì„¸ìš”.<br>")
                .append("<a href='http://" + address + "/sign-up/confirm?id=")
                .append(prememberId)
                .append("&key=")
                .append(key)
                .append("' target='_blenk'>ì´ë©”ì¼ ì¸ì¦í•˜ê¸°</a>")
                .toString();

        message.setText(content, "UTF-8", "html");
        javaMailSender.send(message);
    }
}
```
<br/>
<hr>
<br/>

### âœ…url íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•œ ì •íšŒì› ì „í™˜  

<img width="1137" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-06-30 á„‹á…©á„’á…® 8 17 52" src="https://user-images.githubusercontent.com/80666066/123951936-4cd71d80-d9e0-11eb-865d-158f9ec06d72.png">
ì´ë ‡ê²Œ ë°œì†¡ëœ ë©”ì¼ì˜ ë§í¬ëŠ” íŒŒë¼ë¯¸í„°ë¡œ pkì™€ ë‚œìˆ˜ í‚¤ê°’ì„ ê°–ìŠµë‹ˆë‹¤  
ì´ ë§í¬ë¥¼ í´ë¦­í•  ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê²€ì¦ì„ í•˜ê³ , í•´ë‹¹ íšŒì›ì„ ì •íšŒì›ìœ¼ë¡œ ë“±ë¡í•´ì¤ë‹ˆë‹¤<br/>  

```java
@Controller
@RequiredArgsConstructor
public class MemberController {

    //ì¸ì¦ ë©”ì¼ ë§í¬ë¡œ ë“¤ì–´ì˜¬ ì‹œ íŒŒë¼ë¯¸í„° ê°’ì„ DBì™€ ë¹„êµí•˜ì—¬ ì¼ì¹˜ ì‹œ ì •íšŒì›ìœ¼ë¡œ ë“±ë¡
    @GetMapping("/sign-up/confirm")
    public String signUpConfirm(@RequestParam("id") Long id, @RequestParam("key") String key) {

        //ì„ì‹œ íšŒì›ì˜ í‚¤ê°’ ì¡°íšŒ í›„ ì¼ì¹˜ì‹œ ì •íšŒì› ì „í™˜
        if (memberService.checkPreMemberKey(id, key)) {
            Long memberId = memberService.approveMember(id);
            Member member = memberService.findOneMember(memberId);
            createWelcomeMessage(member);
        }

        return "redirect:/";
    }
}
```
<br/> 
ì•„ë˜ëŠ” ì‹¤ì œë¡œ repositoryë¥¼ í†µí•´ dbì— crudë¥¼ ì‹¤í–‰í•˜ëŠ” memberServiceì˜ ì½”ë“œì…ë‹ˆë‹¤<br/>  

```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class MemberService {

    //ì„ì‹œ íšŒì›ì„ ì •ì‹ íšŒì›ìœ¼ë¡œ ì „í™˜
    @Transactional
    public Long approveMember(Long preMemberId) {
    
        //id ê°’ìœ¼ë¡œ ì„ì‹œ íšŒì›ì„ ì°¾ì•„ ì •ì‹ íšŒì›ìœ¼ë¡œ ê°’ ì„¸íŒ…
        PreMember preMember = preMemberRepository.findOne(preMemberId);
        Member member = Member.createMember(preMember.getName(), preMember.getEmail(), preMember.getPassword());
    
        //íšŒì›ì„ ë“±ë¡í•˜ê³  ì„ì‹œ íšŒì›ì„ ì‚­ì œ
        //ë“±ë¡ ì‹œ ì„ì‹œ í”„ë¡œí•„ì‚¬ì§„ì„ ì§€ì •í•´ì¤Œ
        member.setRandomPicture();
        memberRepository.save(member);
        preMemberRepository.delete(preMember);
    
        return member.getId();
    }
  
        //ì„ì‹œ íšŒì›ì˜ ì¸ì¦í‚¤ë¥¼ ê°’ì„ ë¹„êµí•´ì„œ True / False ë°˜í™˜
        public boolean checkPreMemberKey(Long preMemberId, String key) {
            if(preMemberRepository.findOne(preMemberId).getKey().equals(key)){
                return true;
            }
            else {
                return false;
            }
        }
    }
}
```
<br/>
<hr><br/>

### ğŸ™†ì •íšŒì› ë“±ë¡ ì™„ë£Œì™€ ë¡œê·¸ì¸    
![2021-06-30 20 37 19](https://user-images.githubusercontent.com/80666066/123954364-472f0700-d9e3-11eb-94eb-0b8330aa40fa.gif)

ë©”ì¼ì˜ ë§í¬ë¥¼ í´ë¦­í•´ ë©”ì¼ ì¸ì¦ì„ í–ˆë‹¤ë©´ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤  
íšŒì›ì„ ë“±ë¡í•  ë•Œ ìë™ìœ¼ë¡œ ê²Œì‹œê¸€ í•˜ë‚˜ë¥¼ ìƒì„±í•´ì„œ ë„£ì–´ì„œ,  
ì‹ ê·œ ìœ ì €ê°€ ì•ˆë‚´ë¥¼ ë°›ì„ ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤  
<br/>
ë¡œê·¸ì¸ì— ëŒ€í•œ ìƒì„¸í•œ ì½”ë“œëŠ”  
[ë¡œê·¸ì¸ê³¼ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰](./ë¡œê·¸ì¸ê³¼ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°œê¸‰.md)ì—ì„œ ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤  



