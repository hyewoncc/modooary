## ëª¨ë‘ì–´ë¦¬(ê²Œì‹œíŒ) ê°œì„¤ê³¼ ìˆ˜ì •  

íšŒì›ì€ ëˆ„êµ¬ë‚˜ ìƒˆë¡œìš´ ëª¨ë‘ì–´ë¦¬(ê²Œì‹œíŒ)ì„ ê°œì„¤í•˜ê³  ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  
ëª¨ë‘ì–´ë¦¬ë¥¼ ê°œì„¤í•œ ì‚¬ëŒì€ ê·¸ ëª¨ë‘ì–´ë¦¬ì˜ ê´€ë¦¬ìê°€ ë˜ë©°,  
ëª¨ë‘ì–´ë¦¬ ì„¤ì • ë³€ê²½ê³¼ ì¹œêµ¬ ì´ˆëŒ€ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  

ëª©ì°¨ 
- [ğŸ‰ëª¨ë‘ì–´ë¦¬ ìƒì„±](#ëª¨ë‘ì–´ë¦¬-ìƒì„±)  
- [ğŸ› ï¸ëª¨ë‘ì–´ë¦¬ ì •ë³´ ìˆ˜ì •](#%EF%B8%8Fëª¨ë‘ì–´ë¦¬-ì •ë³´-ìˆ˜ì •)  

<hr>
<br/>

### ğŸ‰ëª¨ë‘ì–´ë¦¬ ìƒì„±  

![2021-07-01 13 50 07](https://user-images.githubusercontent.com/80666066/124066565-dc79dc00-da73-11eb-8fc8-47ddfde5d5ba.gif)

íšŒì›ì´ ìƒˆë¡œ ëª¨ë‘ì–´ë¦¬ë¥¼ ê°œì„¤í•˜ë©´ ì…ë ¥ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒˆë¡œìš´ Diary ê°ì²´ê°€ ìƒì„± ë° ì €ì¥ë©ë‹ˆë‹¤  

<br/>

```java
@Controller
public class DiaryController {
  
    //ìƒˆë¡œìš´ ë‹¤ì´ì–´ë¦¬ ìƒì„± ë˜ëŠ” ìˆ˜ì •
    @PostMapping("/diary")
    public String setDiary(HttpServletRequest request) {
    
        //ì‘ì„±ëœ ë‹¤ì´ì–´ë¦¬ ì´ë¦„ê³¼ ìƒ‰ìƒ ì •ë³´ë¥¼ ì–»ì–´ì˜´
        String diaryTitle = request.getParameter("new-diary-title");
        String colorCode = request.getParameter("color-code");
        Long diaryId;

        //ìƒˆ ë‹¤ì´ì–´ë¦¬ ìƒì„±ì¸ì§€, ê¸°ì¡´ ë‹¤ì´ì–´ë¦¬ ìˆ˜ì •ì¸ì§€ í™•ì¸
        String purpose = request.getParameter("form-purpose");

        //ìƒˆ ë‹¤ì´ì–´ë¦¬ ìƒì„± ë˜ëŠ” ì •ë³´ ìˆ˜ì • í›„ í•´ë‹¹ ë‹¤ì´ì–´ë¦¬ë¡œ ì´ë™
        if(purpose.equals("create")){
            diaryId = createDiary(request.getSession(), diaryTitle, colorCode);
        } else{
            //ë‹¤ì´ì–´ë¦¬ë¥¼ idë¡œ ì°¾ì•„ ì •ë³´ ìˆ˜ì •
            diaryId = Long.parseLong(request.getParameter("diary-id"));
            Diary diary = diarySetService.findDairy(diaryId);
            diarySetService.changeDiaryInfo(diary, diaryTitle, colorCode);
        }
        return "redirect:/diary/" + diaryId;
    }

    //ë‹¤ì´ì–´ë¦¬ ìƒì„± ë©”ì†Œë“œ
    private Long createDiary(HttpSession session, String title, String color) {
        //ì„¸ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¥¼ ë°›ì•„ì˜´
        Long memberId = (Long) session.getAttribute("memberId");
        Member member = memberService.findOneMember(memberId);

        //í˜„ì¬ ì‚¬ìš©ìë¥¼ HOSTë¡œ ìƒˆë¡œìš´ ë‹¤ì´ì–´ë¦¬ ê°œì„¤ í›„ ìƒ‰ìƒ ì ìš©
        Diary diary = Diary.createDiary(title);
        diary.changeColor(color);
        Long diaryId = diarySetService.registerDiary(diary, member);

        //í˜„ì¬ ì‚¬ìš©ìë¥¼ ì‘ì„±ìë¡œ ì²« ê²Œì‹œê¸€ ìë™ ë“±ë¡
        DiaryPost diaryPost = DiaryPost.createPost(diary, member,
                member.getName() + "ë‹˜ì´ " + diary.getTitle() + " ëª¨ë‘ì–´ë¦¬ë¥¼ ê°œì„¤í–ˆìŠµë‹ˆë‹¤!" +
                "\nì¹œêµ¬ë¥¼ ì´ˆëŒ€í•´ ëª¨ë‘ í•¨ê»˜ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”");
        diaryBoardService.registerDiaryPost(diaryPost);

        return diaryId;
    }
}
```

<br/>

ëª¨ë‘ì–´ë¦¬ ê°œì„¤ìì—ê²Œ ì¶”ê°€ ê¶Œí•œì„ ì¤˜ì•¼í•˜ê¸° ë•Œë¬¸ì—,  
DiarySetService ê°ì²´ì— registerDiaryë¼ëŠ” ë³„ë„ì˜ ë©”ì„œë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤  
ì´ ë©”ì„œë“œëŠ” ë‘ ë ˆí¬ì§€í† ë¦¬ë¥¼ ì´ìš©í•´ Diary ê°ì²´ë¥¼ ë¨¼ì € ì €ì¥í•˜ê³ ,  
í˜„ì¬ íšŒì›ì„ ëª¨ë‘ì–´ë¦¬-íšŒì› ê°„ ì†Œì† ì •ë³´ë¥¼ ë‹´ì€ DiaryMemberì— enum íƒ€ì… HOSTë¡œ ì €ì¥í•©ë‹ˆë‹¤  

<br/>  

```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class DiarySetService {
    private final MemberRepository memberRepository;
    private final DiaryRepository diaryRepository;
    private final DiaryMemberRepository diaryMemberRepository;
  
    //ë‹¤ì´ì–´ë¦¬ ìƒì„±
    @Transactional
    public Long registerDiary(Diary diary, Member member){
        //ë‹¤ì´ì–´ë¦¬ ì •ë³´ë¥¼ ì €ì¥
        diaryRepository.save(diary);
      
        //íšŒì›ì„ í˜¸ìŠ¤íŠ¸ë¡œ ì†Œì† ì •ë³´ ë“±ë¡
        DiaryMember diaryMember = DiaryMember.createHost(member, diary);
        diaryMemberRepository.save(diaryMember);
      
        return diary.getId();
    }
}
```

<br/>

ë‹¤ì´ì–´ë¦¬ ìƒì„± í›„ í•´ë‹¹ ë‹¤ì´ì–´ë¦¬ì˜ pkê°’ì„ ë°˜í™˜ ë°›ìŠµë‹ˆë‹¤  
ìƒì„± ê³¼ì •ì´ ëë‚˜ë©´ ë°˜í™˜ë°›ì€ pkê°’ìœ¼ë¡œ í•´ë‹¹ ë‹¤ì´ì–´ë¦¬ í˜ì´ì§€ ì£¼ì†Œë¡œ ì´ë™í•©ë‹ˆë‹¤  

<hr>
<br/><br/>

### ğŸ› ï¸ëª¨ë‘ì–´ë¦¬ ì •ë³´ ìˆ˜ì •  

![2021-07-01 14 12 45](https://user-images.githubusercontent.com/80666066/124070455-d3d7d480-da78-11eb-8c47-c70de0810c18.gif)

ëª¨ë‘ì–´ë¦¬ ê°œì„¤ìì—ê²Œë§Œ ë³´ì´ëŠ” íƒ€ì´í‹€ ì˜† ì•„ì´ì½˜ì„ í†µí•´ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  
ëª¨ë‘ì–´ë¦¬ ìƒì„±ê³¼ ê°™ì€ ëª¨ë‹¬ì°½ì„ ê³µìœ í•˜ê¸°ì—,  
ëª¨ë‹¬ì°½ì„ ì—´ ë•Œ ìƒì„±ì°½ì¸ì§€ ìˆ˜ì •ì°½ì¸ì§€ ê°’ì„ ë³€ê²½í•˜ê²Œ ë©ë‹ˆë‹¤  

<br/>

```java
@Service
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class DiarySetService {
    //ë‹¤ì´ì–´ë¦¬ ì œëª©ê³¼ ìƒ‰ìƒ ì •ë³´ ë³€ê²½
    @Transactional
    public void changeDiaryInfo(Diary diary, String title, String color) {
        diary.changeTitle(title);
        diary.changeColor(color);
    }
}
```

<br/>

```java
@Entity
@Getter
@AllArgsConstructor
public class Diary {
    //ë‹¤ì´ì–´ë¦¬ ìƒ‰ìƒ ë³€ê²½
    public void changeColor(String color) {
        this.color = color;
    }

    //ë‹¤ì´ì–´ë¦¬ ì´ë¦„ ë³€ê²½
    public void changeTitle(String title) {
        this.title = title;
    }
}
```

<br/> 

ìˆ˜ì •ì€ ì¡°íšŒëœ ì—”í‹°í‹° ê°’ì„ ìˆ˜ì •í•˜ëŠ” ê±¸ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤  
Setter ë©”ì„œë“œë¥¼ ì´ìš©í•˜ëŠ” ëŒ€ì‹ ,  
ê°’ì„ ë°›ëŠ” ìƒì„±ìì™€ change~ ëª…ëª…ì„ ë¶™ì¸ í¸ì˜ ë©”ì„œë“œë¥¼ ì‘ì„±í•´  
ê°’ì„ ìˆ˜ì •í•  ë•Œ ëª©ì ì„ ëª…í™•íˆ í•˜ì˜€ìŠµë‹ˆë‹¤  
ìˆ˜ì •ì˜ ê²½ìš°ë„ ì™„ë£Œ í›„ ë°˜í™˜ë°›ì€ ëª¨ë‘ì–´ë¦¬ pkê°’ì„ ì´ìš©í•´ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ìš©ìë¥¼ ì´ë™ì‹œí‚µë‹ˆë‹¤  

<br/>


