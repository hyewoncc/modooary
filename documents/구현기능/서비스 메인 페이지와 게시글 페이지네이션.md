## ì„œë¹„ìŠ¤ ë©”ì¸ í˜ì´ì§€ì™€ ê²Œì‹œê¸€ í˜ì´ì§€ë„¤ì´ì…˜  

<br/>  

![2021-07-01 00 08 17](https://user-images.githubusercontent.com/80666066/123986625-6e94cc80-da01-11eb-99d0-102fc224b3c4.gif)

ë¡œê·¸ì¸ í›„ ì„œë¹„ìŠ¤ ë‚´ë¶€ ë©”ì¸ í˜ì´ì§€ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤  
ë¡œê·¸ì¸ ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ íšŒì›ì´ ì†Œì†ëœ ëª¨ë“  ëª¨ë‘ì–´ë¦¬(ê²Œì‹œíŒ)ì„ ì¡°íšŒí•˜ê³ ,  
ë¨¼ì € ìƒì„±ëœ ì‹œê°„ìˆœìœ¼ë¡œ ìœ„ì—ì„œ ë¶€í„° ë³´ì—¬ì¤ë‹ˆë‹¤  
ì œì¼ ì˜¤ë˜ëœ ëª¨ë‘ì–´ë¦¬ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ë³´ì—¬ì£¼ë©°,  
ê° í•­ëª©ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ê²Œì‹œíŒìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤  

ëª©ì°¨  
- [ğŸ“–ê¸°ë³¸ ë°ì´í„° ì¡°íšŒì™€ ë©”ì¸ í˜ì´ì§€ ìƒì„±](#ê¸°ë³¸-ë°ì´í„°-ì¡°íšŒì™€-ë©”ì¸-í˜ì´ì§€-ìƒì„±)
- [ğŸš«url ì§ì ‘ ì…ë ¥ì„ í†µí•œ ê¶Œí•œì—†ëŠ” ì ‘ê·¼ ë°©ì§€](#url-ì§ì ‘-ì…ë ¥ì„-í†µí•œ-ê¶Œí•œì—†ëŠ”-ì ‘ê·¼-ë°©ì§€)
- [âš™ï¸ê´€ë¦¬ìì—ê²Œë§Œ íŠ¹ì • ê¸°ëŠ¥ ë…¸ì¶œí•˜ê¸°](#%EF%B8%8Fê´€ë¦¬ìì—ê²Œë§Œ-íŠ¹ì •-ê¸°ëŠ¥-ë…¸ì¶œí•˜ê¸°)  
- [ğŸ“ƒê²Œì‹œê¸€ í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ë¬´í•œìŠ¤í¬ë¡¤ ë¡œë”©](#ê²Œì‹œê¸€-í˜ì´ì§€ë„¤ì´ì…˜ê³¼-ë¬´í•œìŠ¤í¬ë¡¤-ë¡œë”©)  

<br/>
<br/>   


### ğŸ“–ê¸°ë³¸ ë°ì´í„° ì¡°íšŒì™€ ë©”ì¸ í˜ì´ì§€ ìƒì„±  

<img width="1434" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-07-01 á„‹á…©á„Œá…¥á†« 12 18 46" src="https://user-images.githubusercontent.com/80666066/123987191-f24eb900-da01-11eb-90b6-7866bdeab6ff.png">

ë‚´ë¶€ ë©”ì¸ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„œëŠ” ë§ì€ ì •ë³´ê°€ í•„ìš”í•©ë‹ˆë‹¤  
- í˜„ì¬ íšŒì›ì˜ ì •ë³´ 
- í˜„ì¬ íšŒì›ì˜ ì´ˆëŒ€ì¥ ì •ë³´  
- íšŒì›ì´ ì†Œì†ëœ ëª¨ë“  ëª¨ë‘ì–´ë¦¬ ëª©ë¡
- í˜„ì¬ ëª¨ë‘ì–´ë¦¬ì˜ ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ ëª©ë¡
- í˜„ì¬ ëª¨ë‘ì–´ë¦¬ì— ì†Œì†ëœ íšŒì›ë“¤ê³¼ ë“±ê¸‰ì˜ ëª©ë¡  

ê° í•­ëª©ì˜ ìƒì„¸í•œ CRUDëŠ” ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ë‹¤ë£¨ë„ë¡ í•˜ê³ ,  
ì—¬ê¸°ì„œëŠ” í˜ì´ì§€ê°€ ìµœì´ˆ ë¡œë”©ë  ë•Œì˜ ê³¼ì •ì„ ì¤‘ì ìœ¼ë¡œ ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤  

<br/>  

```java
@Controller
@RequiredArgsConstructor
public class DiaryController {
  
    @GetMapping("/diary")
    public String diaryHome(HttpSession session, Model model) {

        //ì„¸ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¥¼ ë°›ì•„ì˜´
        Long memberId = (Long) session.getAttribute("memberId");
        Member member = memberService.findOneMember(memberId);

        //í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  ë‹¤ì´ì–´ë¦¬ ëª©ë¡ ì°¾ê¸°
        List<DiaryMember> diaryMembers = new ArrayList<>();
        diaryMembers = member.getDiaryMembers();

        //ë‹¤ì´ì–´ë¦¬ê°€ í•˜ë‚˜ ì´ìƒì´ë¼ë©´ ì•ˆë‚´ ë‹¤ì´ì–´ë¦¬ë¥¼ ë¹¼ê¸°
        if(diaryMembers.size() > 1) {
            diaryMembers.remove(0);
        }

        //í˜„ì¬ ì‚¬ìš©ìì˜ ì²«ë²ˆì§¸ ë‹¤ì´ì–´ë¦¬ (ê°€ì¥ ì˜¤ë˜ ëœ ë‹¤ì´ì–´ë¦¬)ë¡œ ì´ë™
        Diary diary = diaryMembers.get(0).getDiary();
        return "redirect:/diary/" + diary.getId();
    }   
}
```  

<br/>

ë¡œê·¸ì¸ ì‹œ ì„¸ì…˜ì— íšŒì› ì—”í‹°í‹°ì˜ pkê°’ì„ ì €ì¥í•˜ê²Œ ë˜ëŠ”ë°,  
ê·¸ ê°’ì„ í† ëŒ€ë¡œ íšŒì›ì˜ ëª¨ë“  ì†Œì† ëª¨ë‘ì–´ë¦¬ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤  
ê·¸ ë‹¤ìŒ ê°€ì¥ ì˜¤ë˜ ëœ ë‹¤ì´ì–´ë¦¬ pkê°’ìœ¼ë¡œ ë‹¤ì‹œ ë§¤í•‘ì„ í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤  

<br/>

```java
//íŠ¹ì • ë‹¤ì´ì–´ë¦¬ ë³´ì—¬ì£¼ê¸°
@GetMapping("/diary/{diaryId}")
    public String diaryBoard(@PathVariable("diaryId") Long diaryId, HttpSession session, Model model) {
      
      //ì„¸ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¥¼ ë°›ì•„ì˜´
      Long memberId = (Long) session.getAttribute("memberId");
      Member member = memberService.findOneMember(memberId);
      //ëª¨ë¸ì— í˜„ì¬ ì‚¬ìš©ì ì¶”ê°€
      model.addAttribute("member", member);
      
      //ì´ ë‹¤ì´ì–´ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‹¤ì´ì–´ë¦¬ê±°ë‚˜,
      //í˜„ì¬ ì‚¬ìš©ìê°€ ì†Œì† íšŒì›ì´ ì•„ë‹ˆë¼ë©´ ë˜ëŒì•„ê°€ê¸° ì²˜ë¦¬
      if(!(diaryExistCheck(diaryId) &&
                diarySetService.checkMemberInDiary(member, diarySetService.findDairy(diaryId)))){
            return "redirect:/";
      }
      
      //í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  ë‹¤ì´ì–´ë¦¬ ëª©ë¡ ì°¾ê¸°
      List<DiaryMember> diaryMemberForDiary = member.getDiaryMembers();
      
      //ë‹¤ì´ì–´ë¦¬ê°€ 2ê°œ ì´ìƒì´ë©´ ì²˜ìŒ ì•ˆë‚´ ë‹¤ì´ì–´ë¦¬ëŠ” ì‚­ì œ
      if(diaryMemberForDiary.size() > 1) {
        diaryMemberForDiary.remove(0);
      }
      
      //í˜„ì¬ ì‚¬ìš©ìì˜ ëª¨ë“  ë‹¤ì´ì–´ë¦¬ ì°¾ê¸°
      List<Diary> diaries = new ArrayList<>();
      for (DiaryMember dm : diaryMemberForDiary) {
        diaries.add(dm.getDiary());
      }
      
      //ëª¨ë¸ì— ë‹¤ì´ì–´ë¦¬ ëª©ë¡ ì¶”ê°€
      model.addAttribute("diaries", diaries);
      
      //í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì˜ í˜ì´ì§•ëœ í¬ìŠ¤íŠ¸ ì¤‘ ì²«í˜ì´ì§€ë¥¼ ì¡°íšŒ 
      Diary diary = diarySetService.findDairy(diaryId);
      model.addAttribute("diaries", diaries);
      Pageable pageable = PageRequest.of(0, 10, Sort.by("regdate").descending());
      Page<DiaryPost> diaryPosts = diaryBoardService.loadMorePosts(diary, pageable);
      
      //ëª¨ë¸ì— ë‹¤ì´ì–´ë¦¬ì™€ í¬ìŠ¤íŠ¸ ëª©ë¡ ì¶”ê°€
      model.addAttribute("diary", diary);
      model.addAttribute("posts", diaryPosts);
      
      //ëª¨ë“  í¬ìŠ¤íŠ¸ì˜ ëŒ“ê¸€ ì¡°íšŒ
      Map<Long, List<PostReplyDto>> replyMap = new HashMap<>();
      for (DiaryPost dp : diaryPosts) {
        List<PostReply> postReplies = diaryBoardService.listPostReplies(dp);
        List<PostReplyDto> postReplyDtos = postReplies.stream()
            .map(p -> new PostReplyDto(p))
            .collect(Collectors.toList());
        replyMap.put(dp.getId(), postReplyDtos);
      }
      //ëª¨ë¸ì— ëŒ“ê¸€ ë§µ ì¶”ê°€
      model.addAttribute("replyMap", replyMap);
      
      //í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì˜ ëª¨ë“  ë©¤ë²„ ì¡°íšŒ
      List<DiaryMember> members = diary.getDiaryMembers();
      
      //ëª¨ë¸ì— ë©¤ë²„ ëª©ë¡ ì¶”ê°€
      model.addAttribute("members", members);
      
      //í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì—ì„œ ë‚´ ê¶Œí•œ ì°¾ì•„ì„œ ëª¨ë¸ì— ì¶”ê°€
      for (DiaryMember diaryMember : members) {
        if (diaryMember.getMember().equals(member) && diaryMember.getGrade().equals(Grade.HOST)){
          model.addAttribute("host", true);
        }
      }
      
      //í˜„ì¬ íšŒì›ì˜ ëª¨ë“  ì´ˆëŒ€ì¥ ì¡°íšŒ
      List<Invitation> invitations = invitationService.findInvitations(memberId);
      List<InvitationDto> invitationDtos = invitations.stream()
          .map(i -> new InvitationDto(i))
          .collect(Collectors.toList());
      
      //ëª¨ë¸ì— ì´ˆëŒ€ì¥ ëª©ë¡ ì¶”ê°€
      model.addAttribute("invitations", invitationDtos);
      
      //ì„¸ì…˜ì— í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì˜ idê°’ ì¶”ê°€
      session.setAttribute("diaryId", diaryId);
      
      return "diary";
}
```  

<br/>

ì´ë ‡ê²Œ ì¡°íšŒí•œ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ thymeleaf íƒ¬í”Œë¦¿ ì—”ì§„ì„ ì´ìš©í•´ ë™ì ìœ¼ë¡œ í˜ì´ì§€ë¥¼ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤  
ì—”í‹°í‹° ê°„ì— ìˆœí™˜ ì°¸ì¡°ê°€ ë°œìƒí•´ ë¬´í•œ ì¿¼ë¦¬ë¬¸ ì‹¤í–‰ì´ ë˜ì§€ ì•Šë„ë¡,  
ì¼ë¶€ëŠ” í•„ìš”í•œ ì •ë³´ë§Œì„ ë‹´ì€ Dto í´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ìƒì„±í•´ ì •ë³´ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤  
ì•„ë˜ëŠ” ë™ì ìœ¼ë¡œ ëª¨ë‘ì–´ë¦¬ ëª©ë¡ì„ ìƒì„±í•˜ëŠ” ë¶€ë¶„ì˜ ì½”ë“œì…ë‹ˆë‹¤  

<br/>

```html
<div class="diary-list-wrap layout-wrap">
  
  <div class="list-header diary-list-title">
    <div class="diary-list-title-wrap">
      <a>ëª¨ë‘ì–´ë¦¬ ëª©ë¡</a>
    </div>
  </div>
  
  <div class="diary-list">
    <div class="diary-flag" th:each="d : ${diaries}" th:onclick="'location.href=\'/diary/' + ${d.id} + '\''"
         th:style="'background-color:' + '#' + ${d.color}">
      <input type="hidden" th:id="'diary-color' + ${d.id}" th:value="${d.color}">
      <a th:text="${d.title}" class="diary-flag-title"></a>
    </div>
    <div class="diary-flag create-diary" id="add-diary-open">
      <span class="diary-flag-title" id="add-diary">ìƒˆ ëª¨ë‘ì–´ë¦¬ ë§Œë“¤ê¸°</span>
    </div>
  </div>
  
</div>
```

<br/>

ëª¨ë‘ì–´ë¦¬ ëª©ë¡ì„ ìˆœíšŒí•˜ë©° ëª¨ë‘ì–´ë¦¬ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë§í¬ë¥¼ ì„¤ì •í•˜ê³   
ì§€ì •ëœ ì»¬ëŸ¬ì½”ë“œë¥¼ ë°˜ì˜í•´ í•­ëª©ë“¤ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤  
ë‚˜ë¨¸ì§€ ì •ë³´ê°€ ëª¨ë‘ ì‚¬ìš©ë˜ëŠ” ì „ì²´ ì½”ë“œëŠ” [**diary.html**](https://github.com/hyewoncc/modooary/blob/main/src/main/resources/templates/diary.html) ì— ìˆìŠµë‹ˆë‹¤  

<br/>
<hr>
<br/><br/>

### ğŸš«url ì§ì ‘ ì…ë ¥ì„ í†µí•œ ê¶Œí•œì—†ëŠ” ì ‘ê·¼ ë°©ì§€  

![2021-07-01 00 51 26](https://user-images.githubusercontent.com/80666066/123992665-c7b32f00-da06-11eb-96f7-959f1f746558.gif)

<br/>

ëª¨ë‘ì–´ë¦¬ ê²Œì‹œíŒì˜ pkê°’ì´ urlì— ì§ì ‘ ë…¸ì¶œë˜ê¸°ì—,  
ì‚¬ìš©ìê°€ ì´ë¥¼ ìˆ˜ì •í•´ì„œ ìì‹ ì´ ì†Œì†ë˜ì§€ ì•Šì€ ê²Œì‹œíŒì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ DB ì¡°íšŒë¥¼ ê±°ì³ ë°©ì§€í–ˆìŠµë‹ˆë‹¤  
ë³¸ê²©ì ìœ¼ë¡œ í•„ìš”í•œ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê¸° ì „ í™•ì¸í•˜ì—¬, ê¶Œí•œì´ ì—†ì„ ê²½ìš° ë˜ëŒë ¤ë³´ëƒ…ë‹ˆë‹¤  

<br/>

```java
//íŠ¹ì • ë‹¤ì´ì–´ë¦¬ ë³´ì—¬ì£¼ê¸°
@GetMapping("/diary/{diaryId}")
public String diaryBoard(@PathVariable("diaryId") Long diaryId, HttpSession session, Model model) {

    //ì„¸ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ìë¥¼ ë°›ì•„ì˜´
    Long memberId = (Long) session.getAttribute("memberId");
    Member member = memberService.findOneMember(memberId);
    
    //ì´ ë‹¤ì´ì–´ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë‹¤ì´ì–´ë¦¬ê±°ë‚˜,
    //í˜„ì¬ ì‚¬ìš©ìê°€ ì†Œì† íšŒì›ì´ ì•„ë‹ˆë¼ë©´ ë˜ëŒì•„ê°€ê¸° ì²˜ë¦¬
    if(!(diaryExistCheck(diaryId) &&
          diarySetService.checkMemberInDiary(member, diarySetService.findDairy(diaryId)))){
              return "redirect:/";
    }
    
    //ì´í•˜ ì½”ë“œ ìƒëµ 
}
```

<br/>  

diaryExistCheckëŠ” í˜„ì¬ pkê°’ì˜ ë‹¤ì´ì–´ë¦¬ê°€ ì¡´ì¬í•˜ëŠ”ì§€ ê²€ì‚¬í•˜ëŠ” ë©”ì„œë“œ ì…ë‹ˆë‹¤  
í•´ë‹¹ ë©”ì„œë“œì™€ ì„œë¹„ìŠ¤-ë ˆí¬ì§€í† ë¦¬ë¥¼ í†µí•´ ì‹¤í–‰ë˜ëŠ” ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤    

<br/> 

```java
//íŠ¹ì • ë²ˆí˜¸ì˜ ë‹¤ì´ì–´ë¦¬ê°€ ì¡´ì¬í•˜ëŠ” ë‹¤ì´ì–´ë¦¬ì¸ì§€ í™•ì¸
private boolean diaryExistCheck(Long diaryId){
    if(diarySetService.findDairy(diaryId) != null){
        return true;
    }else {
        return false;
    }
}
```

<br/>

```java
@Repository
@RequiredArgsConstructor
public class DiaryRepository {
    private final EntityManager em;
    
    //ë‹¨ì¼ ë‹¤ì´ì–´ë¦¬ ì¡°íšŒ
    public Diary findOne(Long diaryId){
        return em.find(Diary.class, diaryId);
    }
}
```

<br/>

checkMemberInDiaryëŠ” í•´ë‹¹ ë©¤ë²„ê°€ ê·¸ ëª¨ë‘ì–´ë¦¬ì— ì†Œì†ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤  
í•´ë‹¹ ë©”ì„œë“œì™€ ì„œë¹„ìŠ¤-ë ˆí¬ì§€í† ë¦¬ë¥¼ ê±°ì³ ì‹¤í–‰ë˜ëŠ” ì½”ë“œì™€ ì¿¼ë¦¬ë¬¸ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤  

<br/>

```java
//ë‹¨ì¼ íšŒì›ì´ íŠ¹ì • ë‹¤ì´ì–´ë¦¬ì— ì†í•´ìˆëŠ”ì§€ í™•ì¸
public boolean checkMemberInDiary(Member member, Diary diary){
    List<DiaryMember> diaryMembers = diaryMemberRepository.findDairyMembers(diary.getId());
    
    for (DiaryMember diaryMember : diaryMembers) {
        if (diaryMember.getMember().equals(member)) {
            return true;
        }
    }
    
    return false;
}
```

<br/>

```java
@Repository
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class DiaryMemberRepository {
    private final EntityManager em;
    
    //ë‹¨ì¼ ë‹¤ì´ì–´ë¦¬ì— ì†í•œ ëª¨ë“  íšŒì› ì°¾ê¸°
    public List<DiaryMember> findDairyMembers(Long diaryId){
        return em.createQuery("select dm from DiaryMember dm" +
            " where dm.diary.id = :diaryId", DiaryMember.class)
            .setParameter("diaryId", diaryId)
            .getResultList();
    }
}
```

<br/>

ë‘ ê²½ìš° ëª¨ë‘ í•´ë‹¹ë˜ëŠ” ê²½ìš°ì—ë§Œ ì•„ë˜ ì½”ë“œë“¤ì´ ë§ˆì € ì‹¤í–‰ë˜ê²Œ ë˜ë¯€ë¡œ,  
ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì†Œì†ì´ ì•„ë‹Œ ëª¨ë‘ì–´ë¦¬ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ì›ì²œ ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  

<br/>
<hr>
<br/><br/>

### âš™ï¸ê´€ë¦¬ìì—ê²Œë§Œ íŠ¹ì • ê¸°ëŠ¥ ë…¸ì¶œí•˜ê¸°  

<img width="1435" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-07-01 á„‹á…©á„Œá…¥á†« 1 04 43" src="https://user-images.githubusercontent.com/80666066/123994494-62f8d400-da08-11eb-937d-1dcc9b0e8de8.png">
<img width="1438" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2021-07-01 á„‹á…©á„Œá…¥á†« 1 04 49" src="https://user-images.githubusercontent.com/80666066/123994502-64c29780-da08-11eb-90e1-1c1737db9b2d.png">

ì¤‘ì•™ ìƒë‹¨ ëª¨ë‘ì–´ë¦¬ ì´ë¦„ ì˜†ì˜ ì±… ì•„ì´ì½˜ì€ í•´ë‹¹ ëª¨ë‘ì–´ë¦¬ ìƒì„±ìì—ê²Œë§Œ ë³´ì´ëŠ” ì •ë³´ ìˆ˜ì • ë²„íŠ¼ì…ë‹ˆë‹¤  
ë˜, ì¹œêµ¬ì—ê²Œ ì´ˆëŒ€ì¥ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì¢…ì´ë¹„í–‰ê¸° ì•„ì´ì½˜ê³¼ í•­ëª©ë„ ìƒì„±ìì—ê²Œë§Œ ë³´ì…ë‹ˆë‹¤  
ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì„¸ì…˜ì— í˜„ì¬ ì‚¬ìš©ìê°€ HOST ì¸ì§€ GUEST ì¸ì§€ ë“±ê¸‰ ê°’ì„ ì €ì¥í–ˆê¸°ì—,  
í…œí”Œë¦¿ ì—”ì§„ì—ì„œ ì´ë¥¼ í†µí•´ ë…¸ì¶œ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤  

<br/>

```html
<div class="diary-title-wrap" id="diary-title-wrap" th:style="'background-color:' + '#' + ${diary.color}">
  <div class="diary-title-content">
    <a id="diary-title" th:text="${diary.title}"></a>
      <i class="fas fa-book custom-icon" th:if="${host}" id="edit-diary-open" th:onclick="'editDiaryOpen(' + ${diary.id} +');'"></i>
  </div>
</div>
<!-- ì¤‘ê°„ ìƒëµ -->
<div th:if="${host}" class="member-list" id="invite-friend-wrap">
  <div class="member-list-content" id="add-friend-open">
    <div class="member-list-pic-wrap icon">
      <i class="fas fa-paper-plane"></i>
    </div>
  <span>ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°</span>
  </div>
</div>
```

<br/>
<hr>
<br/><br/>  

### ğŸ“ƒê²Œì‹œê¸€ í˜ì´ì§€ë„¤ì´ì…˜ê³¼ ë¬´í•œìŠ¤í¬ë¡¤ ë¡œë”©  

![2021-07-01 01 12 43](https://user-images.githubusercontent.com/80666066/123996062-e961e580-da09-11eb-9587-8a4073981276.gif)


ê²Œì‹œê¸€ ìˆ˜ê°€ ë§ì•„ì§ˆ ìˆ˜ë¡ í•œ ë²ˆì— ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹œê°„ì´ ê±¸ë¦¬ê¸° ë•Œë¬¸ì—  
í˜ì´ì§€ë„¤ì´ì…˜ì„ í†µí•´ 5ê°œì”© ê°€ì ¸ì˜¤ë„ë¡ í–ˆìŠµë‹ˆë‹¤   
ë˜í•œ, SNS ì„œë¹„ìŠ¤ë¥¼ ìƒê°í•˜ê³  ë§Œë“¤ì—ˆê¸°ì—  
í˜ì´ì§€ ìˆ«ìë¥¼ í´ë¦­í•˜ëŠ” ë°©ì‹ì´ ì•„ë‹Œ ë¬´í•œìŠ¤í¬ë¡¤ë¡œ ìë™ í™•ì¥í•˜ëŠ” ë°©ì‹ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤   

ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ í†µí•´ ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì— ë‹¿ëŠ” ê²ƒì„ ê°ì§€í•˜ë©´, 
ë‹¤ìŒ í˜ì´ì§€ì˜ ê²Œì‹œê¸€ì„ ajax í†µì‹ ì„ í†µí•´ DBì—ì„œ ì¡°íšŒí•˜ê³ ,  
ì¡°íšŒëœ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ë“¤ì„ ì¡°íšŒí•œ ë‹¤ìŒì—,  
ë™ì ìœ¼ë¡œ htmlë¬¸ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì„ ë§ˆì§€ë§‰ í˜ì´ì§€ê¹Œì§€ ë°˜ë³µí•©ë‹ˆë‹¤  

<br/>

```javascript
//í˜ì´ì§€ë„¤ì´ì…˜ì„ ìœ„í•œ í•¨ìˆ˜
async function loadMorePosts() {
    let postData = '';
    let replyData = '';
    let diaryId = document.getElementById('diary-id').value;
    let memberPic = document.getElementById('past-picture').value;

    await $.get(`/diary/${diaryId}/load-post?page=${postPage}&size=${postSize}`, function (result){
        postData = result;
    })

    $.each(postData, function (index, post){
        $('#diary-post-content-wrap').append(toPostPage(post));

        $.ajax({
            url: '/load-reply?postId=' + post.id,
            type: 'get',
            success: function (result){
                replyData = result;
                $.each(replyData, function (index, reply){
                    $('#post-' + post.id).append(toReplyPage(reply));
                })
                $('#post-' + post.id).append(addReplyPage(post.id, memberPic));
            }
        })
    })

    postTotal += 5;
    postPage += 1;
    setHoverColor();
}
```  

<br/>

toPostPage, toReplyPage, addReplyPageëŠ” ë°ì´í„°ì— ë§ì¶° htmlì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¡œ ìƒëµí–ˆìŠµë‹ˆë‹¤  
ajaxì— ì‘ë‹µí•˜ëŠ” ì„œë²„ë‹¨ì˜ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤  

<br/>  

```java
@ResponseBody
@GetMapping("/diary/{diaryId}/load-post")
public List<DiaryPostDto> loadMorePosts(
    @PathVariable("diaryId") Long diaryId, @RequestParam int page, @RequestParam int size) {
    
    Diary dairy = diarySetService.findDairy(diaryId);
    Pageable pageable = PageRequest.of(page, size, Sort.by("regdate").descending());
    Page<DiaryPost> diaryPosts = diaryBoardService.loadMorePosts(dairy, pageable);
    List<DiaryPostDto> diaryPostDtos = diaryPosts.stream()
        .map(p -> new DiaryPostDto(p))
        .collect(Collectors.toList());
        
    return diaryPostDtos;
}
```

<br/>  

```java
@GetMapping("/load-reply")
@ResponseBody
public List<PostReplyDto> loadPostReplies(@RequestParam Long postId){
    DiaryPost post = diaryBoardService.findOnePost(postId);
    List<PostReply> postReplies = diaryBoardService.listPostReplies(post);
    List<PostReplyDto> postReplyDtos = postReplies.stream()
        .map(p -> new PostReplyDto(p))
        .collect(Collectors.toList());
    
    return postReplyDtos;
}
```

<br/>  

ë‘ ê²½ìš° ë‹¤ ìˆœí™˜ì°¸ì¡°ì™€ ì¿¼ë¦¬ë¬¸ ë¬´í•œ ì‹¤í–‰ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ Dtoë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤  

<br/>




