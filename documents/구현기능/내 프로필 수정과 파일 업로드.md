## ë‚´ í”„ë¡œí•„ ìˆ˜ì •ê³¼ íŒŒì¼ ì—…ë¡œë“œ  

ì´ë©”ì¼ì„ ì œì™¸í•˜ê³  ì´ë¦„, ë¹„ë°€ë²ˆí˜¸, í”„ë¡œí•„ ì‚¬ì§„ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  
í”„ë¡œí•„ ì‚¬ì§„ì€ ê¸°ë³¸ ì œê³µ ì´ë¯¸ì§€ ì¤‘ì— ì„ íƒí•˜ê±°ë‚˜,  
ì§ì ‘ íŒŒì¼ì„ ì—…ë¡œë“œ í•  ìˆ˜ë„ ìˆê²Œ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤  

<br/> 

ëª©ì°¨  
- [ğŸ™‹ë‚´ í”„ë¡œí•„ ìˆ˜ì •](#ë‚´-í”„ë¡œí•„-ìˆ˜ì •)
- [ğŸ“‚ì‚¬ì§„ íŒŒì¼ ì—…ë¡œë“œ](#ì‚¬ì§„-íŒŒì¼-ì—…ë¡œë“œ)

<br/>
<hr>
<br/><br/> 


### ğŸ™‹ë‚´ í”„ë¡œí•„ ìˆ˜ì •  

![2021-07-03 16 01 42](https://user-images.githubusercontent.com/80666066/124349062-44712380-dc28-11eb-9eff-ac374c415080.gif)

ì´ë©”ì¼ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì •ë³´ë¥¼ ììœ ë¡­ê²Œ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤  
ìˆ˜ì •ì„ ëˆ„ë¥´ë©´ DBì— ë°˜ì˜í•œ í›„, ì›ë˜ ìˆì—ˆë˜ ëª¨ë‘ì–´ë¦¬ í˜ì´ì§€ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤  

<br/>

```java
@Controller
@RequiredArgsConstructor
public class MemberController {
    //ê°œì¸ ì •ë³´ ìˆ˜ì •
    @PostMapping("/info")
    public String editInfo(HttpServletRequest request, @RequestParam("upload-picture") MultipartFile file)
            throws MissingServletRequestPartException {
        //íšŒì› ì°¾ê¸°
        HttpSession session = request.getSession();
        Long memberId = (Long) session.getAttribute("memberId");
        Member member = memberService.findOneMember(memberId);

        //ë‹¤ì´ì–´ë¦¬ ë²ˆí˜¸ ë°›ì•„ì˜¤ê¸°
        Long diaryId = (Long) session.getAttribute("diaryId");

        //íšŒì› ì •ë³´ë¥¼ ë°›ì€ ê°’ìœ¼ë¡œ ë³€ê²½
        memberService.editMemberName(member, request.getParameter("info-name"));
        //ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í–ˆë‹¤ë©´ ë°›ì€ ê°’ìœ¼ë¡œ ë³€ê²½
        if(request.getParameter("new-password") != null) {
            memberService.editMemberPassword(member, request.getParameter("new-password"));
        }

        //í”„ë¡œí•„ ì‚¬ì§„ì´ ì—…ë¡œë“œ ë˜ì—ˆë‹¤ë©´ ì—…ë¡œë“œ ëœ ì‚¬ì§„ ì €ì¥í•˜ê³  ë³€ê²½
        String path = new File("").getAbsolutePath();
        if(file.getSize() != 0){
            try{
                //ì´ë¯¸ì§€ ìœ í˜• ì¶”ì¶œí•˜ê¸°
                String imgType = file.getContentType().substring(file.getContentType().indexOf('/') + 1);
                String imgName = "profile_member" + memberId + "." + imgType;
                String imgPath = path + "/src/main/resources/static/img/" + imgName;
                //ê¸°ì¡´ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ ì‚­ì œ
                File newFile = new File(imgPath);
                if(newFile.exists()){
                    newFile.delete();
                    file.transferTo(new File(imgPath));
                }else{
                    file.transferTo(newFile);
                }
                memberService.editMemberPicture(member, imgName);
            }catch(IOException e) {
                e.printStackTrace();
            }
        }
        //ì‚¬ì§„ì´ ì—…ë¡œë“œ ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì„ íƒëœ ê¸°ë³¸ ì‚¬ì§„ì„ ì €ì¥
        else {
            memberService.editMemberPicture(member, request.getParameter("past-picture"));
        }

        return "redirect:/diary/" + diaryId;
    }
}
```

<br/>

ë¹„ë°€ë²ˆí˜¸ëŠ” ë°”ê¾¸ê³  ì‹¶ì„ ë•Œë§Œ ì¹¸ì„ í´ë¦­í•´ì„œ ìƒˆë¡œ ì…ë ¥í•˜ê¸° í–ˆê¸° ë•Œë¬¸ì—,  
ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆëŠ”ì§€ ì„œë²„ë‹¨ì—ì„œ ì²´í¬í–ˆìŠµë‹ˆë‹¤  

<br/>

![2021-07-03 18 02 45](https://user-images.githubusercontent.com/80666066/124349274-3ec80d80-dc29-11eb-911b-ec5b6eaeea4b.gif)


<br/>

íŒŒì¼ ì—…ë¡œë“œë„ ë§ˆì°¬ê°€ì§€ë¡œ ì›í•˜ëŠ” ì‚¬ëŒë§Œ ì—…ë¡œë“œ í•˜ë„ë¡ í–ˆê¸° ë•Œë¬¸ì—,  
íŒŒì¼ ì—…ë¡œë“œë¥¼ ì¤‘ë„ì— ì·¨ì†Œí•  ë•Œ ë°œìƒí•˜ëŠ” MissingServletRequestPartException ì˜ˆì™¸ë¥¼ throwsë¡œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤  
MemberServiceì˜ ì •ë³´ë¥¼ ê³ ì¹˜ëŠ” ëª¨ë“  ë©”ì„œë“œëŠ” ì—”í‹°í‹° ê°’ì„ ë°”ê¿”ì£¼ëŠ” ì¼ë§Œ í•©ë‹ˆë‹¤  
ì•„ë˜ëŠ” ì˜ˆì‹œë¡œ ì´ë¦„ì„ ë°”ê¾¸ëŠ” ë¶€ë¶„ë§Œ ì˜¬ë¦¬ê² ìŠµë‹ˆë‹¤  

<br/>

```java
@Service
@Transactional(readOnly = true)
public class MemberService {
    /* íšŒì› ì •ë³´ ìˆ˜ì • */
    @Transactional
    public void editMemberName(Member member, String name) {
        member.changeName(name);
    }
}
```

<br/>

```java
@Entity
@Getter
public class Member {
    public void changeName(String name) {
        this.name = name;
    }
}
```

<br/>
<hr>
<br/><br/>


### ğŸ“‚ì‚¬ì§„ íŒŒì¼ ì—…ë¡œë“œ  

![2021-07-04 17 47 00](https://user-images.githubusercontent.com/80666066/124379437-12c48f00-dcf2-11eb-991d-7160e6e11bbc.gif)

í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½ì— íŒŒì¼ ì—…ë¡œë“œë¥¼ êµ¬í˜„í•´ ì´ìš©í–ˆìŠµë‹ˆë‹¤  

<br/>

```java
//í”„ë¡œí•„ ì‚¬ì§„ì´ ì—…ë¡œë“œ ë˜ì—ˆë‹¤ë©´ ì—…ë¡œë“œ ëœ ì‚¬ì§„ ì €ì¥í•˜ê³  ë³€ê²½
String path = new File("").getAbsolutePath();
if(file.getSize() != 0){
    try{
        //ì´ë¯¸ì§€ ìœ í˜• ì¶”ì¶œí•˜ê¸°
        String imgType = file.getContentType().substring(file.getContentType().indexOf('/') + 1);
        String imgName = "profile_member" + memberId + "." + imgType;
        String imgPath = path + "/src/main/resources/static/img/" + imgName;
        
        //ê¸°ì¡´ ì´ë¯¸ì§€ê°€ ìˆë‹¤ë©´ ì‚­ì œ
        File newFile = new File(imgPath);
        if(newFile.exists()){
            newFile.delete();
            file.transferTo(new File(imgPath));
        }else{
            file.transferTo(newFile);
        }
        
        memberService.editMemberPicture(member, imgName);
    }catch(IOException e) {
        e.printStackTrace();
    }
}
```

<br/>

ì´ë¯¸ì§€ íŒŒì¼ì€ ì„œë²„ë‹¨ì˜ ì§€ì • í´ë”ì— ì €ì¥ë˜ë©°,  
DBì—ëŠ” ì´ë¯¸ì§€ íŒŒì¼ ì´ë¦„ì´ ì €ì¥ë©ë‹ˆë‹¤  
ì´ìš©ìë“¤ì´ ì˜¬ë¦¬ëŠ” íŒŒì¼ ê°„ì— ì´ë¦„ì´ ì¤‘ë³µë˜ì–´ ë®ì–´ì“°ì—¬ì§ˆ ìˆ˜ ìˆê¸°ì—,  
ë°›ì€ íŒŒì¼ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ì“°ì§€ ì•Šê³  profile_member + íšŒì›pkê°’ í˜•ì‹ìœ¼ë¡œ ë³€ê²½í•´ ì˜¬ë¦½ë‹ˆë‹¤  

<br/>

ì—…ë¡œë“œ í•  ë•Œ, ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì´ë¯¸ì§€ë¥¼ ë¯¸ë¦¬ í™•ì¸í•  ìˆ˜ ìˆë„ë¡  
ì„ íƒí•œ íŒŒì¼ì„ ë¯¸ë¦¬ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ë„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤  

<br/>

```javascript
//ì‚¬ì§„ ì—…ë¡œë“œ ì‹œ í”„ë¡œí•„ ì´ë¯¸ì§€ì— ë°”ë¡œ ë°˜ì˜
function setUploadImg() {
    let reader = new FileReader();
    reader.onload = e => {
        let img = document.getElementById('info-picture');
        img.src = e.target.result;
    }
    try{
        reader.readAsDataURL(event.target.files[0]);
    }catch{
        resetImg();
    }
}

function resetImg(){
    document.getElementById('info-picture')
        .setAttribute('src', '/img/' + document.getElementById('past-picture').value);
}
```

<br/>

resetImgëŠ” íŒŒì¼ ì—…ë¡œë“œ ì°½ì—ì„œ íŒŒì¼ì„ ì„ íƒí•˜ì§€ ì•Šì•˜ì„ ë•Œ,  
ìƒë‹¨ ì´ë¯¸ì§€ë¥¼ ê¸°ì¡´ í”„ë¡œí•„ ì‚¬ì§„ìœ¼ë¡œ ë‹¤ì‹œ ëŒë ¤ì£¼ëŠ” ê¸°ëŠ¥ì„ í•©ë‹ˆë‹¤  

<br/>





