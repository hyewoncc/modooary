
## ğŸ“¬íšŒì› ê²€ìƒ‰ê³¼ ì´ˆëŒ€ì¥ ì£¼ê³ ë°›ê¸°  

ëª¨ë‘ì–´ë¦¬ì—ì„œëŠ” ê°œì„¤ìê°€ ë‹¤ë¥¸ íšŒì›ì˜ ì´ë¦„, ë˜ëŠ” ì´ë©”ì¼ì„ ê²€ìƒ‰í•´ì„œ ì´ˆëŒ€ì¥ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤  
ì´ˆëŒ€ì¥ì„ ë°›ì€ íšŒì›ì€ í•´ë‹¹ ëª¨ë‘ì–´ë¦¬ì— ê°€ì…í• ì§€ ì„ íƒí•˜ë©´ ë©ë‹ˆë‹¤  
ê°€ì…í•œë‹¤ë©´ ìì‹ ì˜ ëª¨ë‘ì–´ë¦¬ì— í•´ë‹¹ ëª¨ë‘ì–´ë¦¬ê°€ ì¶”ê°€ë©ë‹ˆë‹¤  
<br/>

ëª©ì°¨
- [ğŸ”ë‹¤ë¥¸ íšŒì› ê²€ìƒ‰í•˜ê¸°](#ë‹¤ë¥¸-íšŒì›-ê²€ìƒ‰í•˜ê¸°)
- [âœ‰ï¸íšŒì› ì´ˆëŒ€í•˜ê¸°](#%EF%B8%8FíšŒì›-ì´ˆëŒ€í•˜ê¸°)
- [ğŸ“®ì´ˆëŒ€ ìˆ˜ë½ ë˜ëŠ” ê±°ì ˆí•˜ê¸°](#ì´ˆëŒ€-ìˆ˜ë½-ë˜ëŠ”-ê±°ì ˆí•˜ê¸°)


<br/>
<hr>
<br/><br/>

### ğŸ”ë‹¤ë¥¸ íšŒì› ê²€ìƒ‰í•˜ê¸°  

![2021-07-04 18 37 24](https://user-images.githubusercontent.com/80666066/124382975-0a298400-dd05-11eb-844f-2d23b01660d8.gif)

ì´ˆëŒ€ë¥¼ ìœ„í•´ ë‹¤ë¥¸ íšŒì›ì˜ ì´ë¦„, ì´ë©”ì¼ì„ í‚¤ì›Œë“œ ê²€ìƒ‰í•  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤  

<br/>

```javascript
//ì¹œêµ¬ì°¾ê¸° ê²€ìƒ‰ë€ì˜ ìœ íš¨ì„± ê²€ì‚¬, ë¹„ì–´ìˆë‹¤ë©´ ì¬ì…ë ¥
function checkSearchKeyword(){
    let keywordError = document.getElementById('search-keyword-error');
    //ê²½ê³  ë¬¸êµ¬ê°€ ìˆë‹¤ë©´ ì¼ë‹¨ ë¹„ìš°ê¸°
    keywordError.style.display = 'none';
    keywordError.innerHTML = '';

    if((document.getElementById('search-keyword').value).length == 0){
        keywordError.innerHTML = 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”';
        keywordError.style.display = 'inline';
    }else {
        searchMember();
    }
}

//ì¹œêµ¬ ì°¾ê¸° ajax í†µì‹ 
function searchMember() {
    let keyword = {'keyword' : document.getElementById('search-keyword').value };

    $.ajax({
        url: '/search',
        data: keyword,
        type: 'get',
        success: function(data){
            $('#search-result-list').empty();
            let result = '';

            //ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆë‹¤ë©´ ì¹œêµ¬ ëª©ë¡ì„, ì—†ë‹¤ë©´ ì•ˆë‚´ë¬¸ì„ í‘œê¸°
            if(data.length > 0){
                document.getElementById('search-result-span').innerHTML = (data.length + 'ê±´ì´ ê²€ìƒ‰ë˜ì—ˆì–´ìš”');
                $.each(data, function (index, member){
                    result = $('<div onclick="sendInvitation(' + member.id + ')" class="friend-found">'
                        + '<img class="friend-picture" src="/img/' + member.picture + '">'
                        + '<span class="friend-name">' + member.name +'</span>'
                        + '<span class="friend-email">' + member.email +'</span></div>');
                    $('#search-result-list').append(result);
                })
            }else{
                $('#search-result-list').append($('<span>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”<br/>ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ì°¾ì•„ë³´ì„¸ìš”</span>'));
            }
        }
    })
}
```

<br/>

ê²€ìƒ‰ì–´ ì…ë ¥ í›„ ì—”í„°ë¥¼ ëˆ„ë¥´ê±°ë‚˜ ë‹ë³´ê¸°ë¥¼ í´ë¦­í•˜ë©´ ê³µë€ì´ ì•„ë‹Œì§€ í™•ì¸ í›„,  
ajaxë¡œ ì„œë²„ë‹¨ì—ì„œ íšŒì› ì¡°íšŒ ê²°ê³¼ë¥¼ ë°›ì•„ì™€ ê²°ê³¼ë¥¼ í™”ë©´ë‹¨ì— ìƒˆë¡œ ê·¸ë¦½ë‹ˆë‹¤  
ì¡°íšŒëœ ëª©ë¡ì—ì„œ íšŒì›ì„ í´ë¦­í•˜ë©´ ì´ˆëŒ€ì¥ì´ ë³´ë‚´ì§‘ë‹ˆë‹¤  

<br/>

```java
@Controller
@RequiredArgsConstructor
public class SearchController {
    
    @GetMapping("/search")
    @ResponseBody
    public List<searchMemberDto> searchMember(HttpServletRequest request) {

        //ë¹„ë™ê¸° í†µì‹ ìœ¼ë¡œ ë°›ì€ ë°ì´í„°ë¥¼ ì´ìš©í•´ íšŒì› ê²€ìƒ‰
        Set<Member> members = new HashSet<>();
        String keyword = "%" + request.getParameter("keyword") + "%";
        members.addAll(memberSearchRepository.findByNameLike(keyword));
        members.addAll(memberSearchRepository.findByEmailLike(keyword));

        List<searchMemberDto> result = members.stream()
                .map(m -> new searchMemberDto(m))
                .collect(Collectors.toList());

        return result;
    }
}
```

<br/>

ì´ë¦„ì—ì„œ ê²€ìƒ‰í•œ ê²°ê³¼ì™€ ë©”ì¼ì—ì„œ ê²€ìƒ‰í•œ ê²°ê³¼ê°€ ë‘˜ ë‹¤ ë“¤ì–´ê°‘ë‹ˆë‹¤  
MemberSearchRepository í´ë˜ìŠ¤ëŠ” JpaRepository í´ë˜ìŠ¤ë¥¼ ìƒì†í•´ì„œ,  
Memberë¼ëŠ” ì—”í‹°í‹° íƒ€ì…ê³¼ í‚¤ íƒ€ì…ì¸ Longì„ ì£¼ê³ ,  
ì¿¼ë¦¬ ë©”ì†Œë“œë¥¼ ì‘ëª…ë²•ì— ë”°ë¼ ì •ì˜í–ˆìŠµë‹ˆë‹¤  

<br/>

```java
public interface MemberSearchRepository extends JpaRepository <Member, Long> {
    List<Member> findByNameLike(String keyword);
    List<Member> findByEmailLike(String keyword);
}
``` 

<br/>

ì´ í›„, ëª¨ì€ ê²°ê³¼ê°’ì„ ìˆœí™˜ ì°¸ì¡°ë¥¼ ë§‰ê¸° ìœ„í•´ Dto í´ë˜ìŠ¤ë¡œ ë³€í™˜í•˜ì—¬ í™”ë©´ë‹¨ì— ì „ë‹¬í•©ë‹ˆë‹¤  
í™”ë©´ë‹¨ì—ì„œëŠ” ì´ ê²°ê³¼ë¥¼ ë™ì ìœ¼ë¡œ ë¬¸ì„œì— ì¶”ê°€í•©ë‹ˆë‹¤  

<br/>
<hr>
<br/><br/>


### âœ‰ï¸íšŒì› ì´ˆëŒ€í•˜ê¸°  

![2021-07-06 22 42 15](https://user-images.githubusercontent.com/80666066/124611109-1865d480-deac-11eb-80c8-6cf1e7296842.gif)

ê²€ìƒ‰í•œ íšŒì›ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ íšŒì›ì—ê²Œ ì´ˆëŒ€ì¥ì´ ë³´ë‚´ì§‘ë‹ˆë‹¤  

<br/>

```javascript
//ì¹œêµ¬ì—ê²Œ ì´ˆëŒ€ì¥ ë³´ë‚´ê¸° ajax í†µì‹ 
function sendInvitation(memberId) {
    $.ajax({
        url: '/send-invitation',
        data: {'memberId' : memberId},
        type: 'post',
        success: function (result){
            switch (result) {
                case 'already':
                    toastr.info('ì´ë¯¸ ê°€ì…í•œ ì¹œêµ¬ì…ë‹ˆë‹¤');
                    break;
                case 'waiting':
                    toastr.warning('ì´ë¯¸ ì´ˆëŒ€ì¥ì„ ë³´ë‚¸ ì¹œêµ¬ì…ë‹ˆë‹¤');
                    break;
                case 'complete':
                    toastr.success('ì´ˆëŒ€ì¥ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤');
                    break;
                default: break;
            }
        }
    })
}
```

<br/>

í´ë¦­í•  ë•Œ, í´ë¦­ëœ íšŒì›ì˜ pkê°’ì„ ajax í†µì‹ ìœ¼ë¡œ ì„œë²„ì— ë³´ëƒ…ë‹ˆë‹¤  
ì´í›„ ì„œë²„ë‹¨ì—ì„œ  
1. ì´ˆëŒ€ì¥ì´ ì „ì†¡ë¨
2. ì´ë¯¸ ê°€ì…í•œ íšŒì›ì„(ì´ˆëŒ€ì¥ ì „ì†¡ X)
3. ì´ë¯¸ ì´ˆëŒ€ì¥ì„ ë³´ë‚¸ íšŒì›ì„(ì´ˆëŒ€ì¥ ì „ì†¡ X)
ì„¸ê°€ì§€ ê²½ìš°ì˜ ê²°ê³¼ê°’ì„ ë³´ë‚´ë„ë¡ í–ˆìŠµë‹ˆë‹¤  

<br/>

```java
@Controller
public class InvitationController {
    
    @PostMapping("/send-invitation")
    @ResponseBody
    public String sendInvitation(HttpServletRequest request) {
        //ì„¸ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ì idê°’ì„ ë°›ì•„ ì‚¬ìš©ì ì„¤ì •
        HttpSession session = request.getSession();
        Long memberId = (Long) session.getAttribute("memberId");
        Member member = memberService.findOneMember(memberId);

        //ì„¸ì…˜ì—ì„œ í˜„ì¬ ë‹¤ì´ì–´ë¦¬ idê°’ì„ ë°›ì•„ ë‹¤ì´ì–´ë¦¬ ì„¤ì •
        Long diaryId = (Long) session.getAttribute("diaryId");
        Diary diary = diarySetService.findDairy(diaryId);

        //ajaxë¡œ ë°›ì€ id ê°’ìœ¼ë¡œ ì´ˆëŒ€ì¥ ë³´ë‚¼ íšŒì›ì„ ì°¾ìŒ
        Long receiverId = Long.parseLong(request.getParameter("memberId"));
        Member receiverMember = memberService.findOneMember(receiverId);

        //ë³´ë‚¼ íšŒì›ì´ ì´ë¯¸ í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì— ìˆë‹¤ë©´ already ë°˜í™˜
        if(diarySetService.checkMemberInDiary(receiverMember, diary)){
            return "already";
        }

        //ë³´ë‚¼ íšŒì›ì—ê²Œ ì´ë¯¸ ì´ˆëŒ€ì¥ì„ ë³´ë‚¸ ìƒíƒœë¼ë©´ waiting ë°˜í™˜
        List<Invitation> invitations = invitationService.findInvitations(receiverId);
        for (Invitation invitation : invitations) {
            if(invitation.getDiary().equals(diary)){
                return "waiting";
            }
        }

        //í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì— ì—†ë‹¤ë©´ ì´ˆëŒ€ì¥ì„ ìƒì„±í•˜ê³  ì €ì¥
        Invitation invitation = Invitation.createInvitation(member, receiverMember, diary);
        invitationService.registerInvitation(invitation);
        return "complete";
    }
}
```

<br/>

ë¨¼ì € ì´ˆëŒ€ì¥ì„ ë³´ë‚¼ íšŒì›ì´ í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì— ì†í–ˆëŠ”ì§€ ì¡°íšŒí•˜ëŠ” ë¶€ë¶„ê³¼ ì¿¼ë¦¬ë¬¸ì…ë‹ˆë‹¤  
í˜„ì¬ ë‹¤ì´ì–´ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  íšŒì›ì„ ì¡°íšŒí•˜ê³ ,  
íšŒì› ëª©ë¡ì„ ëŒë©° ì´ˆëŒ€ì¥ì„ ë³´ë‚¼ íšŒì›ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤  

<br/>

```java
@Service
@Transactional(readOnly = true)
public class DiarySetService {
    //ë‹¨ì¼ íšŒì›ì´ íŠ¹ì • ë‹¤ì´ì–´ë¦¬ì— ì†í•´ìˆëŠ”ì§€ í™•ì¸
    public boolean checkMemberInDiary(Member member, Diary diary){
        List<DiaryMember> diaryMembers = diaryMemberRepository.findDairyMembers(diary.getId());
        for (DiaryMember diaryMember : diaryMembers) {
            if (diaryMember.getMember().equals(member)) {
                return true;
            }
        }
        return false;
    }
}

@Repository
@Transactional(readOnly = true)
public class DiaryMemberRepository {
    //ë‹¨ì¼ ë‹¤ì´ì–´ë¦¬ì— ì†í•œ ëª¨ë“  íšŒì› ì°¾ê¸°
    public List<DiaryMember> findDairyMembers(Long diaryId){
        return em.createQuery("select dm from DiaryMember dm" +
                " where dm.diary.id = :diaryId", DiaryMember.class)
                .setParameter("diaryId", diaryId)
                .getResultList();
    }

}
```  

<br/>

ëª¨ë‘ ë¶ˆì¼ì¹˜í•œë‹¤ë©´, ê·¸ íšŒì›ì˜ ëª¨ë“  ì´ˆëŒ€ì¥ì„ ì¡°íšŒí•©ë‹ˆë‹¤  
ê·¸ë¦¬ê³  í˜„ì¬ ë‹¤ì´ì–´ë¦¬ì˜ ì´ˆëŒ€ì¥ì´ ìˆì§€ ì•Šì€ì§€ í™•ì¸í•©ë‹ˆë‹¤  

<br/>

```java
@Service
@Transactional(readOnly = true)
public class InvitationService {
    //íšŒì›ì—ê²Œ ì˜¨ ëª¨ë“  ì´ˆëŒ€ì¥ ì¡°íšŒ
    public List<Invitation> findInvitations(Long memberId) {
        List<Invitation> invitations = new ArrayList<>();
        invitations = invitationRepository.findInvitations(memberId);
        return invitations;
    }
}

@Repository
@Transactional(readOnly = true)
public class InvitationRepository {
    //íŠ¹ì • íšŒì›ì´ ë°›ì€ ëª¨ë“  ì´ˆëŒ€ì¥ ì¡°íšŒ
    public List<Invitation> findInvitations(Long memberId) {
        return em.createQuery("select i from Invitation i" +
                " where i.receiver.id = :memberId")
                .setParameter("memberId", memberId)
                .getResultList();
    }
}
```

<br/>

í•´ë‹¹ ë‹¤ì´ì–´ë¦¬ì˜ ì´ˆëŒ€ì¥ì´ ì—†ë‹¤ë©´,  
ì´ˆëŒ€ì¥ ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤  

<br/>

```java
@Entity
@Getter
public class Invitation {
    //setterëŠ” ì ‘ê·¼ ì œí•œìë¥¼ privateë¡œ ì„¤ì •   
  
    /* ìƒì„± ë©”ì„œë“œ */
    //ìƒˆë¡œìš´ ì´ˆëŒ€ì¥ ìƒì„±
    public static Invitation createInvitation(Member sender, Member receiver, Diary diary) {
        Invitation invitation = new Invitation();
        invitation.setSender(sender);
        invitation.setReceiver(receiver);
        invitation.setDiary(diary);
        return invitation;
    }
}
```

<br/>

```java
@Service
@Transactional(readOnly = true)
public class InvitationService {
    //ì´ˆëŒ€ì¥ ë“±ë¡
    @Transactional
    public Long registerInvitation(Invitation invitation) {
        invitationRepository.save(invitation);
        return invitation.getId();
    }
}
```

<br/>
<hr>
<br/><br/>

### ğŸ“®ì´ˆëŒ€ ìˆ˜ë½ ë˜ëŠ” ê±°ì ˆí•˜ê¸°  

![2021-07-06 23 21 42](https://user-images.githubusercontent.com/80666066/124617224-b90ac300-deb1-11eb-8d03-a5507bfe6491.gif)

íšŒì›ì€ ìì‹ ì—ê²Œ ì˜¨ ì´ˆëŒ€ì¥ì„ ê±°ì ˆí•˜ê±°ë‚˜,  
ìˆ˜ë½í•˜ì—¬ í•´ë‹¹ ëª¨ë‘ì–´ë¦¬ì— ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  
íšŒì›ì´ ëª¨ë‘ì–´ë¦¬ ë‚´ë¶€ í˜ì´ì§€ì— ë“¤ì–´ì˜¤ë©´,  
í˜„ì¬ ê°–ê³  ìˆëŠ” ëª¨ë“  ì´ˆëŒ€ì¥ì„ ì¡°íšŒí•´ì„œ ìš°í¸í•¨ì— ë³´ì—¬ì£¼ê³ , ì•„ì´ì½˜ì— ì•Œë¦¼ ë§ˆí¬ë¥¼ ë¶™ì—¬ì¤ë‹ˆë‹¤  

<br/>

```java
@Controller
public class DiaryController {
    //íŠ¹ì • ë‹¤ì´ì–´ë¦¬ ë³´ì—¬ì£¼ê¸°
    @GetMapping("/diary/{diaryId}")
    public String diaryBoard(@PathVariable("diaryId") Long diaryId, HttpSession session, Model model) {
        //ë‹¤ë¥¸ ì½”ë“œ ìƒëµ
        //í˜„ì¬ íšŒì›ì˜ ëª¨ë“  ì´ˆëŒ€ì¥ ì¡°íšŒ
        List<Invitation> invitations = invitationService.findInvitations(memberId);
        List<InvitationDto> invitationDtos = invitations.stream()
                .map(i -> new InvitationDto(i))
                .collect(Collectors.toList());
        //ëª¨ë¸ì— ì´ˆëŒ€ì¥ ëª©ë¡ ì¶”ê°€
        model.addAttribute("invitations", invitationDtos);
      
        return "diary";
    }
}
```

<br/>

íŠ¹ì • íšŒì›ì˜ ëª¨ë“  ì´ˆëŒ€ì¥ì„ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì‘ì„±í•œ ì¿¼ë¦¬ë¬¸ì…ë‹ˆë‹¤  

<br/>

```java
@Repository
@Transactional(readOnly = true)
public class InvitationRepository {
    //íŠ¹ì • íšŒì›ì´ ë°›ì€ ëª¨ë“  ì´ˆëŒ€ì¥ ì¡°íšŒ
    public List<Invitation> findInvitations(Long memberId) {
        return em.createQuery("select i from Invitation i" +
                " where i.receiver.id = :memberId")
                .setParameter("memberId", memberId)
                .getResultList();
    }
}
``` 

<br/>

ì´ ì´ˆëŒ€ì¥ë“¤ë¡œ ì´ˆëŒ€ë¥¼ ìˆ˜ë½/ê±°ì ˆí•˜ëŠ” ë©”ì„œë“œê°€ í¬í•¨ëœ htmlì„ ë™ì  ìƒì„±í•©ë‹ˆë‹¤  

<br/>

```html
<div class="invitation-wrap" th:id="'invitation-' + ${i.id}" th:each="i : ${invitations}">
  <div class="invitation-wrap left">
    <div class="post-picture-wrap">
      <img class="post-picture small" th:src="'/img/' + ${i.sender_picture}">
    </div>
    <div class="invitation-content-wrap">
      <span class="invitation-content" th:text="${i.sender_name} + 'ë‹˜ì˜ ì´ˆëŒ€'"></span>
      <span class="invitation-content" th:text="'[' + ${i.diary_title} + ']'"></span>
    </div>
  </div>
  <div class="invitation-wrap right">
    <i class="fas fa-check invitation-button accept" th:onclick="'acceptInvitation(' + ${i.id} + ');'"></i>
    <i class="fas fa-times invitation-button reject" th:onclick="'rejectInvitation(' + ${i.id} + ');'"></i>
  </div>
</div>
```

<br/> 

ì´ˆëŒ€ì¥ì´ ì—¬ëŸ¬ê°œì¼ ì‹œ, í•œ í™”ë©´ì—ì„œ ë¦¬ë¡œë“œ ì—†ì´ ë°”ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²Œ í¸í•˜ë¯€ë¡œ  
ë‘˜ ë‹¤ ajax í†µì‹ ìœ¼ë¡œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤  
ê·¸ë¦¬ê³  ìš°í¸í•¨ì„ ë‹«ì•˜ì„ ë•Œ, í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì„ í•˜ë„ë¡ í•´  
ì˜†ì— ì¶”ê°€ëœ ëª¨ë‘ì–´ë¦¬ê°€ ë°”ë¡œ ë³´ì´ë„ë¡ í–ˆìŠµë‹ˆë‹¤  

<br/>

```javascript
//ì´ˆëŒ€ì¥ ìˆ˜ë½í•˜ê¸° ajax í†µì‹ 
function acceptInvitation(invitationId) {
    $.ajax({
        url: '/accept-invitation',
        data: {'invitationId': invitationId},
        type: 'post',
        success: function (){
            $('#invitation-' + invitationId).remove();
            toastr.success('ê°€ì…í–ˆìŠµë‹ˆë‹¤');
            checkInvitations();
        }
    })
}

//ì´ˆëŒ€ì¥ ê±°ì ˆí•˜ê¸° ajax í†µì‹ 
function rejectInvitation(invitationId) {
    $.ajax({
        url: '/reject-invitation',
        data: {'invitationId': invitationId},
        type: 'post',
        success: function (){
            $('#invitation-' + invitationId).remove();
            toastr.info('ê°€ì…ì„ ê±°ì¡€í–ˆìŠµë‹ˆë‹¤');
            checkInvitations();
        }
    })
}
```

<br/>

```java
@Controller
@RequiredArgsConstructor
public class InvitationController {
    @PostMapping("/accept-invitation")
    @ResponseBody
    public void acceptInvitation(HttpServletRequest request) {
        //ì „ì†¡ëœ ì´ˆëŒ€ì¥ idê°’ì„ ë°›ì•„ì™€ì„œ ì°¾ìŒ
        Long invitationId = Long.parseLong(request.getParameter("invitationId"));
        Invitation invitation = invitationService.findOne(invitationId);

        //ì´ˆëŒ€ì¥ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ íšŒì›ì„ ë‹¤ì´ì–´ë¦¬ì— ë“±ë¡
        diarySetService.registerDiaryMember(invitation.getDiary(), invitation.getReceiver());

        //ì´ˆëŒ€ì¥ ì‚­ì œ
        invitationService.deleteInvitation(invitation);
    }

    @PostMapping("/reject-invitation")
    @ResponseBody
    public void rejectInvitation(HttpServletRequest request) {
        //ì „ì†¡ëœ ì´ˆëŒ€ì¥ idê°’ì„ ë°›ì•„ì™€ì„œ ì°¾ìŒ
        Long invitationId = Long.parseLong(request.getParameter("invitationId"));
        Invitation invitation = invitationService.findOne(invitationId);

        //ì´ˆëŒ€ì¥ ì‚­ì œ
        invitationService.deleteInvitation(invitation);
    }
}
```

<br/>

ì´ˆëŒ€ ê±°ì ˆì€ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ëŠ” ê±¸ë¡œ ì²˜ë¦¬í–ˆê³ ,  
ìˆ˜ë½ì€ í•´ë‹¹ íšŒì›ì„ GUEST ë“±ê¸‰ìœ¼ë¡œ ë‹¤ì´ì–´ë¦¬ ì†Œì†ì •ë³´ë¥¼ ì €ì¥í–ˆìŠµë‹ˆë‹¤  

<br/>

```java
@Service
@Transactional(readOnly = true)
public class DiarySetService {
    //ê²ŒìŠ¤íŠ¸ íšŒì› ì†Œì† ì •ë³´ ë“±ë¡
    @Transactional
    public Long registerDiaryMember(Diary diary, Member member){
        //íšŒì›ì„ ê²ŒìŠ¤íŠ¸ë¡œ ì†Œì† ì •ë³´ ë“±ë¡
        DiaryMember diaryMember = DiaryMember.createGuest(member, diary);
        diaryMemberRepository.save(diaryMember);

        return diaryMember.getId();
    }
}
```

<br/>

```java
@Entity
@Getter
public class DiaryMember {
    //setterëŠ” ì ‘ê·¼ ì œí•œì‚¬ë¥¼ privateë¡œ ì„¤ì • 
  
    //ê´€ë¦¬ì íšŒì›ì´ ë‹¤ë¥¸ íšŒì›ì„ ë‹¤ì´ì–´ë¦¬ë¡œ ì´ˆëŒ€í–ˆì„ ë•Œ
    public static DiaryMember createGuest(Member member, Diary diary){
        DiaryMember diaryMember = new DiaryMember();
        diaryMember.setMember(member);
        diaryMember.setDiary(diary);
        diaryMember.setGuest();
        member.addDiaryInfo(diaryMember);

        return diaryMember;
    }
}
```

<br/>


