## ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ ì‘ì„±  

íšŒì›ì€ ëˆ„êµ¬ë‚˜ ììœ ë¡­ê²Œ ì†Œì† ëª¨ë‘ì–´ë¦¬ì— ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤  
ê²Œì‹œê¸€ì€ í˜ì´ì§€ ìƒë‹¨ì—ì„œ ì‘ì„±í•˜ê¸°ì— ì‘ì„±í•  ë•Œ ë§ˆë‹¤ í˜ì´ì§€ë¥¼ ë¦¬ë¡œë“œ í•˜ë„ë¡ í–ˆìœ¼ë‚˜,  
ëŒ“ê¸€ì€ ë¬´í•œìŠ¤í¬ë¡¤ë¡œ ê²Œì‹œê¸€ì„ ë‚´ë¦¬ë©´ì„œ ì—°ì†ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡  
ajax ë¹„ë™ê¸° í†µì‹ ì„ ì´ìš©í•´ ë“±ë¡í•˜ê³  í•´ë‹¹ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ëª©ë¡ë§Œ ìƒˆë¡œ ë°›ì•„ì˜¤ë„ë¡ í–ˆìŠµë‹ˆë‹¤  

<br/>

ëª©ì°¨
- [âœï¸ê²Œì‹œê¸€ ì‘ì„±í•˜ê¸°](#%EF%B8%8Fê²Œì‹œê¸€-ì‘ì„±í•˜ê¸°)
- [ğŸ’¬ajaxë¡œ ëŒ“ê¸€ ì‘ì„±ê³¼ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ê¸°](#ajax-ëŒ“ê¸€-ì‘ì„±ê³¼-ìƒˆë¡œ-ë¶ˆëŸ¬ì˜¤ê¸°)
- [ğŸ§¶ì‚¬ìš©ì í¸ì˜ë¥¼ ìœ„í•œ í™”ë©´ ì¸í„°ë ‰ì…˜](#ì‚¬ìš©ì-í¸ì˜ë¥¼-ìœ„í•œ-í™”ë©´-ì¸í„°ë ‰ì…˜)

<br/>
<hr>
<br/><br/>

### âœï¸ê²Œì‹œê¸€ ì‘ì„±í•˜ê¸°  

![2021-07-01 15 36 00](https://user-images.githubusercontent.com/80666066/124140488-7b79f480-dac3-11eb-8ba4-50e03e621740.gif)

ì‚¬ìš©ìê°€ ê²Œì‹œê¸€ ì‘ì„± í›„ ìš°ì¸¡ ì—°í•„ ì•„ì´ì½˜ì„ í´ë¦­í•˜ë©´ ê²Œì‹œê¸€ì´ ë“±ë¡ë©ë‹ˆë‹¤  
ë‹¤ì´ì–´ë¦¬-ê²Œì‹œê¸€ ê°„ì˜ ì¼ëŒ€ë‹¤ ì—°ê´€ê´€ê³„,  
ê·¸ë¦¬ê³  íšŒì›-ê²Œì‹œê¸€ ê°„ì˜ ì¼ëŒ€ë‹¤ ì—°ê´€ê´€ê³„ê°€ ì–´ê¸‹ë‚˜ì§€ ì•Šë„ë¡  
ê²Œì‹œê¸€ ì—”í‹°í‹°ì— ë³„ë„ì˜ ìƒì„± ë©”ì„œë“œë¥¼ ë§Œë“  í›„  
ì„¸ì…˜ê°’ìœ¼ë¡œ ì¡°íšŒí•œ ì—”í‹°í‹° ê°ì²´ ìì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ë„ë¡ í–ˆìŠµë‹ˆë‹¤  

<br/> 

```java
@Controller
@RequiredArgsConstructor
public class PostController {

    private final DiaryBoardService diaryBoardService;
    private final DiarySetService diarySetService;
    private final MemberService memberService;

    @PostMapping("/post")
    public String uploadPost(HttpServletRequest request) {
        HttpSession session = request.getSession();

        //í˜„ì¬ ì‚¬ìš©ìì™€ ë‹¤ì´ì–´ë¦¬ ê°’ ì„¸ì…˜ì—ì„œ ë°›ì•„ ì°¾ê¸°
        Long memberId = (Long) session.getAttribute("memberId");
        Member member = memberService.findOneMember(memberId);
        Long diaryId = (Long) session.getAttribute("diaryId");
        Diary diary = diarySetService.findDairy(diaryId);

        //ì…ë ¥ëœ í¬ìŠ¤íŠ¸ ë‚´ìš©ì„ ë°›ì•„ì„œ í¬ìŠ¤íŠ¸ ê°ì²´ ìƒì„±
        String postText = request.getParameter("post_text");
        DiaryPost diaryPost = DiaryPost.createPost(diary, member, postText);
        diaryBoardService.registerDiaryPost(diaryPost);

        //ë‹¤ì´ì–´ë¦¬ë¡œ ëŒì•„ê°€ê¸°
        return "redirect:/diary/" + diary.getId();
    }
}
```  

<br/> 

```java
@Entity
public class DiaryPost {
    /* ìƒì„± ë©”ì„œë“œ */
    public static DiaryPost createPost(Diary diary, Member member, String content){
        DiaryPost diaryPost = new DiaryPost();
        diaryPost.setDiary(diary);
        diaryPost.setMember(member);
        diaryPost.setContent(content);
        diaryPost.setCreateTime();

        return diaryPost;
    }
}
```

<br/>

ì—”í‹°í‹° Setterì˜ ê²½ìš° ëª¨ë‘ ì ‘ê·¼ìë¥¼ privateìœ¼ë¡œ ì„¤ì •í–ˆê¸°ì—  
ìƒì„±í•  ë•Œë¥¼ ì œì™¸í•˜ê³  ê°’ ë³€ê²½ì€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤  

<br/>
<hr>
<br/><br/>  

### ğŸ’¬ajax ëŒ“ê¸€ ì‘ì„±ê³¼ ìƒˆë¡œ ë¶ˆëŸ¬ì˜¤ê¸°  

![2021-07-01 15 38 38](https://user-images.githubusercontent.com/80666066/124142113-e841be80-dac4-11eb-949c-ceac8a8853cd.gif)

ëŒ“ê¸€ ì‘ì„±ì€ ë¹„ë™ê¸° í†µì‹ ìœ¼ë¡œ ì´ë£¨ì–´ ì§‘ë‹ˆë‹¤  
ì‚¬ìš©ìê°€ ëŒ“ê¸€ì„ ì‘ì„±í•˜ë©´, ìš°ì„  PostReply ì—”í‹°í‹°ë¥¼ ìƒì„±í•´ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ë„£ì€ í›„  
í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì „ì²´ ëŒ“ê¸€ë§Œ ì¬ì¡°íšŒí•˜ì—¬ ëŒ“ê¸€ ì˜ì—­ì˜ ë‚´ìš©ë¬¼ì„ ì§€ìš°ê³  ìƒˆë¡œ ë™ì  ì¶”ê°€í•´ì¤ë‹ˆë‹¤  
ë‹¤ì´ì–´ë¦¬ í˜ì´ì§€ë¥¼ ë™ì  ìƒì„±í•  ë•Œ ëŒ“ê¸€ í¼ì˜ idì— ê²Œì‹œê¸€ì˜ pkê°’ì„ ë„£ì–´ì£¼ëŠ”ë°,  
ê·¸ ê°’ì„ í† ëŒ€ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤  

<br/>

```html
<!-- ëŒ“ê¸€ ì‘ì„±ë€ì˜ ì½”ë“œ -->
<!-- pëŠ” ì„œë²„ë‹¨ì—ì„œ ë°›ì•„ì˜¨ post(ê²Œì‹œê¸€) ê°ì²´ í•˜ë‚˜ -->
<div class="reply-content add-new-reply">
    <textarea class="text-input-clear reply reply-text" th:id="'reply-content' + ${p.id}"
          th:onkeyup="'resize_replyarea(this, \'new-reply-submit' + ${p.id} + '\');'"></textarea>
    <i class="fas fa-pen custom-icon reply-submit hover-diary-color" th:id="'new-reply-submit' + ${p.id}"
          th:onclick="'sendReply(' + ${p.id} + ');'"></i>
</div>
```

<br/> 

```javascript
//ëŒ“ê¸€ ajax í†µì‹ 
function sendReply(postId) {
    let data = {'reply' : document.getElementById('reply-content' + postId).value,
                'postId' : postId};

    $.ajax({
        url: '/post-reply',
        data: data,
        type: 'post',
        success: function(replyList){
            $('#reply-list' + postId).empty();
            $.each(replyList, function (index, reply){
                let replyDiv = $('<div class="post-reply"><div class="reply-picture-wrap">' +
                    '<img class="reply-picture" src="/img/' + reply.picture +'"></div>' +
                    '<div class="reply-content"><span>' + reply.name + '</span> ' +
                    '<pre class="reply-text">' + reply.content +'</pre></div></div>');
                $('#reply-list' + postId).append(replyDiv);
            })
            $('#reply-content' + postId).val('');
            $('#reply-content' + postId).css('height', '30px');
            $('#new-reply-submit' + postId).css('marginTop', '6px');
        }
    })
}
```

<br/>

ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ëŒ“ê¸€ ajax í†µì‹ ì´ ë“¤ì–´ì˜¤ë©´  
ëŒ“ê¸€ì„ ë“±ë¡í•œ í›„ í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì „ì²´ ëŒ“ê¸€ì„ ì¡°íšŒí•´ ë°˜í™˜í•´ì¤ë‹ˆë‹¤  

<br/>

```java
@Controller
@RequiredArgsConstructor
public class ReplyController {

    private final MemberService memberService;
    private final DiaryBoardService diaryBoardService;

    @PostMapping("/post-reply")
    @ResponseBody
    public List<PostReplyDto> registerReply(HttpServletRequest request) {

        //ì„¸ì…˜ì—ì„œ í˜„ì¬ ì‚¬ìš©ì idê°’ì„ ë°›ì•„ ì‚¬ìš©ì ì„¤ì •
        HttpSession session = request.getSession();
        Long memberId = (Long) session.getAttribute("memberId");
        Member member = memberService.findOneMember(memberId);

        //ë¹„ë™ê¸° í†µì‹ ìœ¼ë¡œ ë°›ì€ ë°ì´í„°ë¥¼ ì´ìš©í•´ ëŒ“ê¸€ ì €ì¥
        Long postId = Long.parseLong(request.getParameter("postId"));
        DiaryPost diaryPost = diaryBoardService.findOnePost(postId);
        String reply = request.getParameter("reply");
        PostReply postReply = PostReply.createPostReply(diaryPost, member, reply);
        diaryBoardService.registerPostReply(postReply);

        //ëŒ“ê¸€ì„ ì‘ì„±í•œ í¬ìŠ¤íŠ¸ì˜ idê°’ìœ¼ë¡œ ëŒ“ê¸€ì„ ë‹¤ì‹œ ì½ì–´ì˜¤ê¸°
        List<PostReply> postReplies = diaryBoardService.listPostReplies(diaryPost);
        List<PostReplyDto> postReplyDtos = postReplies.stream()
                .map(p -> new PostReplyDto(p))
                .collect(Collectors.toList());

        return postReplyDtos;
    }
}
```

<br/>

PostReply ê°ì²´ ë˜í•œ ë³„ë„ì˜ ìƒì„± ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ í˜¼ì„ ì„ ë°©ì§€í–ˆìŠµë‹ˆë‹¤  
ê²Œì‹œê¸€ idê°’ ê¸°ì¤€ìœ¼ë¡œ ëŒ“ê¸€ì„ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì‘ì„±í•œ ë ˆí¬ì§€í† ë¦¬ì˜ ì¿¼ë¦¬ë¬¸ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤  

<br/>

```java
@Repository
@Transactional(readOnly = true)
@RequiredArgsConstructor
public class PostReplyRepository {
    private final EntityManager em;
    
    //íŠ¹ì • í¬ìŠ¤íŠ¸ì— ì†í•œ ëª¨ë“  ëŒ“ê¸€ ì¡°íšŒ
    public List<PostReply> findPostReplies(Long postId) {
        return em.createQuery("select dr from PostReply dr" +
                " where dr.diaryPost.id = :postId", PostReply.class)
                .setParameter("postId", postId)
                .getResultList();
    }
}
```

<br/>

ì´ í›„ ìˆœí™˜ì°¸ì¡°ë¥¼ ë§‰ê¸°ìœ„í•´ Dto í´ë˜ìŠ¤ë¡œ ë³€í™˜ë˜ì–´ ë‹¤ì‹œ í™”ë©´ë‹¨ì— ì „ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤  

<br/>
<hr>
<br/><br/>

### ğŸ§¶ì‚¬ìš©ì í¸ì˜ë¥¼ ìœ„í•œ í™”ë©´ ì¸í„°ë ‰ì…˜  

![2021-07-01 23 52 24](https://user-images.githubusercontent.com/80666066/124276037-48e10200-db7e-11eb-8eda-f9768bb7e17c.gif)

cssì™€ javascriptë¥¼ ì´ìš©í•´ ì´ìš© ì¤‘ ì–´ìƒ‰í•¨ì´ ì—†ë„ë¡ ì¸í„°ë ‰ì…˜ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤  
ì¤„ë…¸íŠ¸ ëŠë‚Œì„ ì£¼ê¸° ìœ„í•´ ë§Œë“  ê¸€ê³¼ ëŒ“ê¸€ ì‘ì„± ë¶€ë¶„ì€ ì°½ í¬ê¸°ê°€ ë³€í•˜ê±°ë‚˜ ì—”í„°ë¥¼ ì¹˜ë©´ ë‚´ìš©ë¬¼ì— ë§ì¶° ë³€í•©ë‹ˆë‹¤  

<br/>

![2021-07-01 15 47 29](https://user-images.githubusercontent.com/80666066/124276265-8776bc80-db7e-11eb-800b-bd477e0c0fcf.gif)

<br/> 

ê¸€ ì‘ì„±ë€ì—ì„œ í‚¤ë³´ë“œë¥¼ ì…ë ¥í•  ë•Œ ë§ˆë‹¤ í¬ê¸°ë¥¼ ê³„ì‚°í•´ì„œ ë°°ê²½ íŒ¨í„´ ì¤„ì„ ê¹”ë„ë¡ í–ˆìŠµë‹ˆë‹¤  
ì½”ë“œëŠ” ê²Œì‹œê¸€ ì‘ì„±ë€ ë¶€ë¶„ì…ë‹ˆë‹¤  

<br/>

```html
<form role="form" action="/post" method="post" id="new-post-form">
    <textarea class="text-input-clear post" name="post_text" id="post_text"
              onkeyup="resize_postarea(this, 'new-post-submit')"></textarea>
</form>
```

<br/>

```javascript
//ì°½ í¬ê¸°ê°€ ë°”ë€” ë•Œ ì‘ì„±ì¤‘ì¸ í¬ìŠ¤íŠ¸ì˜ ì…ë ¥ì°½ í¬ê¸°ë„ ì¬ì¡°ì •
$(window).resize(function () {
    resize_postarea(document.getElementById('post_text'), 'new-post-submit');
})
    
//í¬ìŠ¤íŠ¸ ì“°ê¸° ì˜ì—­ ë¦¬ì‚¬ì´ì§•
function resize_postarea(textarea, button) {
    textarea.style.height = "30px";
    textarea.style.height = (30 + (textarea.scrollHeight - 36)) + "px";
    document.getElementById(button).style.marginTop = (28 + (textarea.scrollHeight - 36)) + "px";
}
```  

<br/>



